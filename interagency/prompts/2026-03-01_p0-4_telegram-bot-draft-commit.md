# PROMPT ‚Äî P0.4 Telegram Bot ‚Üí Agro Draft‚ÜíCommit (apps/telegram-bot)
–î–∞—Ç–∞: 2026-03-01  
–°—Ç–∞—Ç—É—Å: active  
–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: P0  
Decision-ID: AG-TELEGRAM-DRAFT-COMMIT-001  

## –¶–µ–ª—å
–°–¥–µ–ª–∞—Ç—å –æ–¥–∏–Ω –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π Telegram-–∫–æ–Ω—Ç—É—Ä: `apps/telegram-bot` –∫–∞–∫ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –∫–æ—Ç–æ—Ä—ã–π **–≤—Å–µ–≥–¥–∞** —Å–æ–∑–¥–∞—ë—Ç Agro draft –ø—Ä–∏ –ª—é–±–æ–º –≤—Ö–æ–¥–µ (text/voice/photo), —Ç—Ä–µ–±—É–µ—Ç —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚úÖ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ `fix/link/confirm` –ø–æ –∫–Ω–æ–ø–∫–∞–º ‚Äî –±–µ–∑ —Ä–∞–∑–¥–≤–æ–µ–Ω–∏—è —Ç–µ–ª–µ–≥—Ä–∞–º-–∫–æ–Ω—Ç—É—Ä–æ–≤.

## –ö–æ–Ω—Ç–µ–∫—Å—Ç
- –ß–µ–∫–ª–∏—Å—Ç P0.4: `docs/00_STRATEGY/STAGE 2/PROJECT_EXECUTION_CHECKLIST.md`
- –ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π backend-–∫–æ–Ω—Ç—É—Ä Draft‚ÜíCommit –¥–æ–ª–∂–µ–Ω –∂–∏—Ç—å –≤ `apps/api` (—Å–º. P0.3: `interagency/prompts/2026-03-01_p0-3_agro-telegram-draft-commit.md`).
- –ë–æ—Ç —É–∂–µ —É–º–µ–µ—Ç —Ö–æ–¥–∏—Ç—å –≤ API —á–µ—Ä–µ–∑ `ApiClientService` –∏ —Ö—Ä–∞–Ω–∏—Ç—å access token –≤ `SessionService` (`apps/telegram-bot/src/telegram/telegram.update.ts`).

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–∂—ë—Å—Ç–∫–æ)
- Admission/security gate: —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–ø—É—Å—Ç–∏–º–∞ **—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–≥–æ `Decision-ID` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `ACCEPTED`**.
- Tenant isolation: –±–æ—Ç **–Ω–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç `companyId` –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã** –∏–∑ callback/body; tenant –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ (—á–µ—Ä–µ–∑ auth —Ç–æ–∫–µ–Ω / –∫–æ–Ω—Ç–µ–∫—Å—Ç API).
- –ù–∏–∫–∞–∫–æ–≥–æ ‚Äú–≤—Ç–æ—Ä–æ–≥–æ —Ç–µ–ª–µ–≥—Ä–∞–º-–∫–æ–Ω—Ç—É—Ä–∞‚Äù: P0.4 —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç `apps/telegram-bot` –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç.
- –ù–µ –¥–µ–ª–∞—Ç—å UI-–ø–æ–ª–∏—Ä–æ–≤–∫—É –∏ ‚Äú—É–º–Ω—ã–µ‚Äù —Ç–µ–∫—Å—Ç—ã; –Ω—É–∂–Ω—ã –∫–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã + –∫–Ω–æ–ø–∫–∏ –∏ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫.

## –ó–∞–¥–∞—á–∏ (—á—Ç–æ —Å–¥–µ–ª–∞—Ç—å)
- [ ] –í—ã–±—Ä–∞—Ç—å –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π —Ç–µ–ª–µ–≥—Ä–∞–º-–∫–æ–Ω—Ç—É—Ä: `apps/telegram-bot` (—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç) + –¥–æ–º–µ–Ω–Ω—ã–π API –≤ `apps/api`.
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å intake –≤ –±–æ—Ç–µ:
  - [ ] text ‚Üí create draft
  - [ ] voice ‚Üí (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ) create draft —Å evidence=audio (–±–µ–∑ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è, –µ—Å–ª–∏ –≤–Ω–µ scope)
  - [ ] photo ‚Üí create draft —Å evidence=photo (uri/metadata –ø–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É API)
- [ ] –ù–∞ –∫–∞–∂–¥—ã–π draft –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∫–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç + inline-–∫–Ω–æ–ø–∫–∏:
  - ‚úÖ `confirm` (callback —Å `draftId`)
  - ‚úèÔ∏è `fix` (callback —Å `draftId`, –∑–∞—Ç–µ–º —Å–±–æ—Ä –ø—Ä–∞–≤–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–µ–º)
  - üîó `link` (callback —Å `draftId`, –∑–∞—Ç–µ–º —Å–±–æ—Ä refs)
- [ ] –û—Ñ–æ—Ä–º–∏—Ç—å callback data —Ç–∞–∫, —á—Ç–æ–±—ã **–≤—Å–µ–≥–¥–∞** –Ω–µ—Å—Ç–∏ `draftId` –∏ –¥–µ–π—Å—Ç–≤–∏–µ (`confirm|fix|link`).
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥–æ–Ω/—Ç–µ—Å—Ç —Å—Ü–µ–Ω–∞—Ä–∏—è: ‚Äú—Ñ–æ—Ç–æ+—Ç–µ–∫—Å—Ç ‚Üí draft ‚Üí link ‚Üí confirm ‚Üí committed‚Äù (e2e –ª–∏–±–æ —Å–∫—Ä–∏–ø—Ç-–ø—Ä–æ–≥–æ–Ω —Å –ª–æ–≥–∞–º–∏).

## Definition of Done (DoD)
- [ ] –ë–æ—Ç —Å–æ–∑–¥–∞—ë—Ç draft –ø—Ä–∏ –≤—Ö–æ–¥–µ (text/voice/photo) –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ ‚úÖ‚úèÔ∏èüîó —Å `draftId`.
- [ ] –ü–æ –Ω–∞–∂–∞—Ç–∏—é –∫–Ω–æ–ø–æ–∫ –±–æ—Ç –≤—ã–∑—ã–≤–∞–µ—Ç `fix/link/confirm` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –¥–æ–º–µ–Ω–Ω–æ–≥–æ API.
- [ ] –ù–µ—Ç –ø—Ä–∏—ë–º–∞/–ø–µ—Ä–µ–¥–∞—á–∏ `companyId` –∏–∑ –Ω–µ–¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ –≤–≤–æ–¥–∞; tenant –±–µ—Ä—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ API (auth/session).
- [ ] Telegram-–∫–æ–Ω—Ç—É—Ä –Ω–µ —Ä–∞–∑–¥–≤–∞–∏–≤–∞–µ—Ç—Å—è: `apps/telegram-bot` ‚Äî –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç.

## –¢–µ—Å—Ç-–ø–ª–∞–Ω (–º–∏–Ω–∏–º—É–º)
- [ ] –†—É—á–Ω–æ–π –ø—Ä–æ–≥–æ–Ω (–ª–æ–≥–∞–º–∏): ‚Äú—Ñ–æ—Ç–æ+—Ç–µ–∫—Å—Ç ‚Üí draftId ‚Üí link ‚Üí confirm ‚Üí committed‚Äù
- [ ] –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–≥–æ–Ω: confirm –ø—Ä–∏ `missingMust[]` ‚â† [] –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é MUST-–≤–æ–ø—Ä–æ—Å—ã/—Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç API –∏ –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç.

## –ß—Ç–æ –≤–µ—Ä–Ω—É—Ç—å –Ω–∞ —Ä–µ–≤—å—é
- –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (—Å–ø–∏—Å–æ–∫)
- –§—Ä–∞–≥–º–µ–Ω—Ç—ã –ª–æ–≥–æ–≤ –ø—Ä–æ–≥–æ–Ω–∞ (draftId, –≤—ã–∑–æ–≤—ã API, confirm blocked/committed)
- –ö–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ callback data —Ñ–æ—Ä–º–∞—Ç–∞ –∏ –º–∞–ø–ø–∏–Ω–≥–∞ –∫–Ω–æ–ø–æ–∫ ‚Üí API –≤—ã–∑–æ–≤—ã

