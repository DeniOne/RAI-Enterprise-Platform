# Меню 1: Управление Урожаем

## 1. Бизнес-роль

Главный операционный контур системы: план -> техкарта -> исполнение -> отклонения -> результат.

## 2. Целевое дерево страниц

- `/consulting/dashboard`
- `/consulting/crm/farms`
- `/consulting/crm/counterparties`
- `/consulting/crm/fields`
- `/consulting/crm/history`
- `/consulting/plans`
- `/consulting/plans/drafts`
- `/consulting/plans/active`
- `/consulting/plans/archive`
- `/consulting/techmaps`
- `/consulting/techmaps/design`
- `/consulting/techmaps/active`
- `/consulting/techmaps/frozen`
- `/consulting/techmaps/archive`
- `/consulting/execution`
- `/consulting/execution/agronomist`
- `/consulting/execution/manager`
- `/consulting/deviations`
- `/consulting/deviations/detected`
- `/consulting/deviations/analysis`
- `/consulting/deviations/decisions`
- `/consulting/results/actual`
- `/consulting/results/plan-fact`
- `/consulting/results/performance`

## 3. Фактический статус

- Реализованы: `dashboard`, `plans` (хаб), `techmaps` (хаб), `execution*`, `deviations*`, `budgets`, `yield`, `advisory`.
- Добавлено в текущем цикле:
  - рабочие страницы `crm/*` с подключением данных (`fields`, `plans`) и сводными метриками;
  - рабочая группа `results/*` (хаб + подроуты);
  - подроуты `plans/*` и `techmaps/*` без 404.
- Осталось: углубить сценарии CRUD и действия по каждому CRM-подразделу.

## 4. API-связки

- Планы: `/api/consulting/plans*`
- Техкарты: `/api/tech-map*`
- Исполнение: `/api/tasks*`, `/api/field-observation*`
- Отклонения/решения: `/api/consulting/deviations*`, `/api/consulting/decisions*`
- Результаты/KPI: `/api/consulting/yield*`, `/api/consulting/kpi*`
- CRM-данные: `/api/crm*`, `/api/registry/fields*`, `/api/registry/clients*`

## 5. Критерий готовности MVP

- Пользователь может пройти сценарий end-to-end без выхода из UI:
  1. создать/активировать план,
  2. проверить техкарту,
  3. запустить исполнение,
  4. зафиксировать отклонение,
  5. увидеть план/факт результата.

## 6. Поведение кнопки меню "Управление Урожаем"

### 6.1 Что происходит при нажатии на пункт меню

- Клик по пункту верхнего меню `Управление Урожаем` открывает рабочий вход в контур: `/consulting/dashboard`.
- Если пользователь уже внутри `/consulting/*`, повторный клик возвращает в `/consulting/dashboard` (как "домашнюю" точку раздела).
- Раздел в левом меню раскрыт и подсвечен: активен родитель `Управление Урожаем` и конкретный подпункт текущего маршрута.

### 6.2 Что пользователь должен увидеть на первом экране

- На `/consulting/dashboard` отображается операционная сводка по компании `test-company-1`:
  - активные планы,
  - статус исполнения,
  - количество отклонений,
  - ключевые KPI/урожайность.
- Все виджеты кликабельны и ведут в соответствующие разделы (`plans`, `execution`, `deviations`, `results`).
- Данные загружаются из API, без статических заглушек.

### 6.3 Навигация внутри раздела после входа

- Пользователь может перейти в подпункты без выхода из контура:
  - CRM: `/consulting/crm/*`
  - Планы: `/consulting/plans/*`
  - Техкарты: `/consulting/techmaps/*`
  - Исполнение: `/consulting/execution/*`
  - Отклонения: `/consulting/deviations/*`
  - Результаты: `/consulting/results/*`
- При переходах сохраняется единый layout раздела и контекст компании (`test-company-1`).

### 6.4 Ожидаемое UX-поведение (обязательно)

- `Loading`: skeleton/loader на карточках и таблицах.
- `Empty`: явное сообщение "данных пока нет" + CTA на создание первого объекта (план, техкарта и т.д.).
- `Error`: понятное сообщение об ошибке + кнопка повтора запроса.
- `Permission`: при отсутствии прав скрываем действие или показываем "Недостаточно прав" без падения страницы.

### 6.5 Критерий готовности кнопки

- Клик по `Управление Урожаем` всегда ведет в рабочий экран `/consulting/dashboard`.
- Пользователь за 2-3 клика доходит до любого ключевого подпроцесса (CRM, планы, техкарты, исполнение, отклонения, результаты).
- Для всех целевых страниц раздела отрабатывают состояния `loading/empty/error`.

## 7. Интерактивность дашборда (в стиле RAI)

### 7.1 Кликабельность блоков

- KPI-плитки кликабельны и ведут в соответствующие рабочие разделы:
  - `Активные планы` -> `/consulting/plans/active`
  - `Техкарты в работе` -> `/consulting/techmaps/active`
  - `Отклонения` -> `/consulting/deviations/detected`
  - `Исполнение` -> `/consulting/execution`
  - `Маржа` -> `/consulting/results/performance`
- Блок `Алерты и события` кликабелен построчно: каждый алерт открывает связанную сущность/раздел.
- Нижние статус-плитки (`в норме / риск / критические`) кликабельны и открывают соответствующие фильтрованные представления.

### 7.2 Правило для бегущей строки

- Если в бегущей строке присутствует критичный (красный) алерт, он должен быть кликабельным.
- Клик по критичному алерту ведет напрямую в сущность отклонения/решения (например, `deviations/detected` с query-параметром сущности).
- Некритичные информационные элементы строки могут оставаться неактивными.

### 7.3 UX-принцип

- Дашборд не только визуализирует состояние, но и работает как `операционный пульт`: любой значимый сигнал должен быть кликом переведен в действие.

### 7.4 Smart routing контракт

- Для перехода из алерта используем query-параметр `entity` (например: `?entity=DEV-001`).
- Целевая страница обязана:
  - прочитать `entity`,
  - найти соответствующую строку/карточку,
  - подсветить найденный элемент,
  - сделать авто-скролл к нему.
- Если сущность не найдена, показываем нейтральное уведомление "сущность не найдена в текущем списке".

