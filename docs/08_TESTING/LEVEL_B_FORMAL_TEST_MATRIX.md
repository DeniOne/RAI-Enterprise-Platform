# LEVEL_B_FORMAL_TEST_MATRIX.md

## 0. Статус документа

- **Система:** RAI_Enterprise_Platform
- **Компонент:** Level B Formal Test Matrix
- **Статус:** FORMAL SPECIFICATION
- **Зависимости:** INVARIANT_EXTENSION_FOR_LEVEL_B.md, все Level B спецификации
- **Document Maturity Level:** D3 (Verification-Ready)

---

## 1. Назначение (Purpose)

Данный документ ДОЛЖЕН определить полную матрицу формальных тестов для Level B платформы RAI Enterprise Platform. Матрица ДОЛЖНА обеспечивать 100% покрытие инвариантов I15-I28.

Спецификация ДОЛЖНА обеспечить:
- Полное покрытие всех инвариантов I15-I28
- Трассировку тестов к требованиям
- Уровни тестирования (L3-L6)
- Критерии приёмки для каждого теста

---

## 2. Область применения (Scope)

### 2.1 Входит в область

- Матрица тестов для всех инвариантов I15-I28
- Уровни тестирования (L3-L6)
- Трассировка тестов к компонентам
- Критерии приёмки
- Стратегия выполнения тестов
- Метрики покрытия

### 2.2 Не входит в область (см. Раздел 10)

- Реализация тестов
- Тестовые фреймворки
- CI/CD конфигурация
- Производительность тестов
- Тестовые данные
- Инфраструктура тестирования

---

## 3. Формальные определения (Formal Definitions)

### 3.1 Уровни тестирования

```
TestLevel := L3 | L4 | L5 | L6

L3: Структурные тесты
  - Проверка схемы данных
  - Проверка наличия обязательных полей
  - Проверка типов данных

L4: Тесты формальных инвариантов
  - Проверка соблюдения инвариантов I15-I28
  - Проверка блокировки нарушений
  - Проверка детерминизма

L5: Тесты на основе свойств (Property-Based)
  - Генерация случайных входных данных
  - Проверка свойств для всех входов
  - Проверка граничных случаев

L6: Интеграционные тесты
  - Проверка взаимодействия компонентов
  - Проверка сквозных сценариев
  - Проверка FSM переходов
```

### 3.2 Структура теста

```
FormalTest := {
  testId: String,
  invariantId: String,      // I15-I28
  component: String,
  level: TestLevel,
  description: String,
  preconditions: String[],
  steps: String[],
  expectedResult: String,
  acceptanceCriteria: String,
  traceId: String
}
```

---

## 4. Матрица тестов по инвариантам

### 4.1 I15: Изоляция генеративных черновиков

| Test ID | Уровень | Компонент | Описание | Trace ID |
|---------|---------|-----------|----------|----------|
| I15-L3-01 | L3 | FSM | Проверка наличия состояния GENERATED_DRAFT | TRACE-LB-TEST-I15-01 |
| I15-L4-01 | L4 | IntegrityGate | Блокировка автоматического утверждения | TRACE-LB-TEST-I15-02 |
| I15-L4-02 | L4 | UI | Обязательное явное действие пользователя | TRACE-LB-TEST-I15-03 |
| I15-L5-01 | L5 | FSM | Невозможность обхода UI | TRACE-LB-TEST-I15-04 |
| I15-L6-01 | L6 | End-to-End | Сквозной сценарий утверждения черновика | TRACE-LB-TEST-I15-05 |

### 4.2 I16: Провенанс генерации

| Test ID | Уровень | Компонент | Описание | Trace ID |
|---------|---------|-----------|----------|----------|
| I16-L3-01 | L3 | Schema | Наличие поля generationMetadata | TRACE-LB-TEST-I16-01 |
| I16-L4-01 | L4 | GenerativeEngine | Запись всех полей метаданных | TRACE-LB-TEST-I16-02 |
| I16-L4-02 | L4 | UI | Видимость метаданных в UI | TRACE-LB-TEST-I16-03 |
| I16-L5-01 | L5 | GenerativeEngine | Полнота метаданных для всех генераций | TRACE-LB-TEST-I16-04 |
| I16-L6-01 | L6 | End-to-End | Сквозная проверка провенанса от генерации до UI | TRACE-LB-TEST-I16-05 |

### 4.3 I17: Верховенство человеческого переопределения

| Test ID | Уровень | Компонент | Описание | Trace ID |
|---------|---------|-----------|----------|----------|
| I17-L4-01 | L4 | UI | Доступность кнопок отклонения/редактирования | TRACE-LB-TEST-I17-01 |
| I17-L4-02 | L4 | FSM | Возможность отклонения генеративного черновика | TRACE-LB-TEST-I17-02 |
| I17-L6-01 | L6 | End-to-End | Сквозной сценарий переопределения | TRACE-LB-TEST-I17-03 |

### 4.4 I18: Неизменяемость библиотеки стратегий

| Test ID | Уровень | Компонент | Описание | Trace ID |
|---------|---------|-----------|----------|----------|
| I18-L3-01 | L3 | Schema | Триггеры неизменяемости на уровне БД | TRACE-LB-TEST-I18-01 |
| I18-L4-01 | L4 | StrategyLibrary | Блокировка изменения опубликованной стратегии | TRACE-LB-TEST-I18-02 |
| I18-L4-02 | L4 | IntegrityGate | Валидация неизменяемости | TRACE-LB-TEST-I18-03 |
| I18-L5-01 | L5 | StrategyLibrary | Неизменяемость хеша | TRACE-LB-TEST-I18-04 |
| I18-L6-01 | L6 | End-to-End | Сквозная проверка неизменяемости опубликованной стратегии | TRACE-LB-TEST-I18-05 |

### 4.5 I19: Детерминированная генерация

| Test ID | Уровень | Компонент | Описание | Trace ID |
|---------|---------|-----------|----------|----------|
| I19-L4-01 | L4 | GenerativeEngine | Детерминизм B1 (без seed) | TRACE-LB-TEST-I19-01 |
| I19-L4-02 | L4 | YieldModel | Детерминизм прогнозов B1 | TRACE-LB-TEST-I19-02 |
| I19-L4-03 | L4 | SimulationModule | Детерминизм симуляций при фиксированном seed | TRACE-LB-TEST-I19-03 |
| I19-L5-01 | L5 | GenerativeEngine | Детерминизм для 10,000 входов | TRACE-LB-TEST-I19-04 |
| I19-L6-01 | L6 | End-to-End | Сквозная проверка детерминизма генерации и прогнозов | TRACE-LB-TEST-I19-05 |

### 4.6 I20: Прослеживаемость модели урожайности

| Test ID | Уровень | Компонент | Описание | Trace ID |
|---------|---------|-----------|----------|----------|
| I20-L3-01 | L3 | Schema | Наличие полей modelVersion, inputData | TRACE-LB-TEST-I20-01 |
| I20-L4-01 | L4 | YieldModel | Запись всех полей прослеживаемости | TRACE-LB-TEST-I20-02 |
| I20-L5-01 | L5 | YieldModel | Полнота прослеживаемости для всех прогнозов | TRACE-LB-TEST-I20-03 |
| I20-L6-01 | L6 | End-to-End | Сквозная проверка прослеживаемости прогноза урожайности | TRACE-LB-TEST-I20-04 |

### 4.7 I21: Распространение ограничений

| Test ID | Уровень | Компонент | Описание | Trace ID |
|---------|---------|-----------|----------|----------|
| I21-L4-01 | L4 | GenerativeEngine | Копирование ограничений из стратегии | TRACE-LB-TEST-I21-01 |
| I21-L4-02 | L4 | IntegrityGate | Валидация наличия ограничений | TRACE-LB-TEST-I21-02 |
| I21-L6-01 | L6 | End-to-End | Сквозная проверка распространения | TRACE-LB-TEST-I21-03 |

### 4.8 I22: Изоляция симуляций

| Test ID | Уровень | Компонент | Описание | Trace ID |
|---------|---------|-----------|----------|----------|
| I22-L3-01 | L3 | Schema | Поле isProduction всегда false | TRACE-LB-TEST-I22-01 |
| I22-L4-01 | L4 | SimulationModule | Нет записи в производственные таблицы | TRACE-LB-TEST-I22-02 |
| I22-L4-02 | L4 | SimulationModule | Нет влияния на FSM TechMap | TRACE-LB-TEST-I22-03 |
| I22-L5-01 | L5 | SimulationModule | Изоляция для всех симуляций | TRACE-LB-TEST-I22-04 |

### 4.9 I23: Запрет обратной совместимости

| Test ID | Уровень | Компонент | Описание | Trace ID |
|---------|---------|-----------|----------|----------|
| I23-L4-01 | L4 | GenerativeEngine | Версия генеративного черновика = 1 | TRACE-LB-TEST-I23-01 |
| I23-L4-02 | L4 | IntegrityGate | Блокировка перезаписи существующей версии | TRACE-LB-TEST-I23-02 |

### 4.10 I24: Обязательная объяснимость

| Test ID | Уровень | Компонент | Описание | Trace ID |
|---------|---------|-----------|----------|----------|
| I24-L3-01 | L3 | Schema | Наличие поля explainability | TRACE-LB-TEST-I24-01 |
| I24-L4-01 | L4 | GenerativeEngine | Запись объяснимости | TRACE-LB-TEST-I24-02 |
| I24-L4-02 | L4 | YieldModel | Запись объяснимости прогнозов | TRACE-LB-TEST-I24-03 |
| I24-L4-03 | L4 | UI | Видимость объяснимости | TRACE-LB-TEST-I24-04 |
| I24-L4-04 | L4 | IntegrityGate | limitationsDisclosed = true | TRACE-LB-TEST-I24-05 |
| I24-L5-01 | L5 | All | Объяснимость для 100% сущностей | TRACE-LB-TEST-I24-06 |
| I24-L6-01 | L6 | End-to-End | Сквозная проверка объяснимости от генерации до UI | TRACE-LB-TEST-I24-07 |

### 4.11 I25: Нормализация вероятности (B2+)

| Test ID | Уровень | Компонент | Описание | Trace ID |
|---------|---------|-----------|----------|----------|
| I25-L4-01 | L4 | YieldModel | Интеграл распределения = 1 ± 0.001 | TRACE-LB-TEST-I25-01 |
| I25-L5-01 | L5 | YieldModel | Нормализация для всех прогнозов B2+ | TRACE-LB-TEST-I25-02 |

### 4.12 I26: Границы вероятности (B2+)

| Test ID | Уровень | Компонент | Описание | Trace ID |
|---------|---------|-----------|----------|----------|
| I26-L4-01 | L4 | YieldModel | Все p(y) в диапазоне [0, 1] | TRACE-LB-TEST-I26-01 |
| I26-L5-01 | L5 | YieldModel | Границы для всех прогнозов B2+ | TRACE-LB-TEST-I26-02 |

### 4.13 I27: Доверительный интервал (B2+)

| Test ID | Уровень | Компонент | Описание | Trace ID |
|---------|---------|-----------|----------|----------|
| I27-L4-01 | L4 | YieldModel | Доверие в диапазоне [0.8, 0.99] | TRACE-LB-TEST-I27-01 |
| I27-L5-01 | L5 | YieldModel | Доверие для всех прогнозов B2+ | TRACE-LB-TEST-I27-02 |

### 4.14 I28: Неизменяемость записи генерации

| Test ID | Уровень | Компонент | Описание | Trace ID |
|---------|---------|-----------|----------|----------|
| I28-L3-01 | L3 | Schema | Триггеры неизменяемости GenerationRecord | TRACE-LB-TEST-I28-01 |
| I28-L4-01 | L4 | GenerativeEngine | Блокировка изменения записи | TRACE-LB-TEST-I28-02 |
| I28-L5-01 | L5 | GenerativeEngine | Неизменяемость для всех записей | TRACE-LB-TEST-I28-03 |
| I28-L6-01 | L6 | End-to-End | Сквозная проверка неизменяемости GenerationRecord | TRACE-LB-TEST-I28-04 |

---

## 5. Выравнивание FSM (FSM Alignment)

### 5.1 Состояния Level B FSM

```
Level B расширяет Level A FSM следующими состояниями:

GENERATED_DRAFT (новое состояние)
  - Черновик создан генеративным движком
  - Требует явного человеческого утверждения
  - Блокирует автоматические переходы

Существующие состояния Level A:
  DRAFT → APPROVED → SCHEDULED → IN_PROGRESS → COMPLETED → ARCHIVED

Новые переходы Level B:
  DRAFT → GENERATED_DRAFT (через GenerativeEngine)
  GENERATED_DRAFT → HUMAN_APPROVE_DRAFT (явное действие пользователя)
  GENERATED_DRAFT → DRAFT (отклонение/редактирование)
```

### 5.2 Валидация переходов FSM

| Переход | Валидирующие тесты | Инварианты | Trace ID |
|---------|-------------------|------------|----------|
| DRAFT → GENERATED_DRAFT | I15-L3-01, I16-L4-01, I24-L4-01 | I15, I16, I24 | TRACE-LB-FSM-01 |
| GENERATED_DRAFT → HUMAN_APPROVE_DRAFT | I15-L4-01, I15-L4-02, I17-L4-01 | I15, I17 | TRACE-LB-FSM-02 |
| GENERATED_DRAFT → DRAFT | I17-L4-02, I17-L6-01 | I17 | TRACE-LB-FSM-03 |
| SimulationRun (изоляция) | I22-L4-02, I22-L5-01 | I22 | TRACE-LB-FSM-04 |

### 5.3 Недопустимые переходы (Invalid Transitions)

```
Следующие переходы ДОЛЖНЫ быть заблокированы:

1. GENERATED_DRAFT → APPROVED (без HUMAN_APPROVE_DRAFT)
   - Блокируется: I15-L4-01
   - Механизм: IntegrityGate валидация actorType = 'HUMAN'

2. GENERATED_DRAFT → SCHEDULED (обход утверждения)
   - Блокируется: I15-L5-01
   - Механизм: FSM валидация предыдущего состояния

3. SimulationRun → TechMap.status изменение
   - Блокируется: I22-L4-02
   - Механизм: isProduction = false, нет записи в production tables

4. Автоматический триггер → HUMAN_APPROVE_DRAFT
   - Блокируется: I15-L4-01, I15-L4-02
   - Механизм: UI обязательное явное действие
```

**Trace:** [TRACE-LB-FSM-05]

---

## 6. Ограничения детерминизма (Determinism Constraints)

### 6.1 DC-1: Строгий детерминизм B1

**Ограничение:**
```
∀ входных параметров P (для B1):
  ∀ n ∈ ℕ:
    generate(P)₀ = generate(P)ₙ

где равенство — побайтовая идентичность
```

**Покрывающие тесты:**
- I19-L4-01: Детерминизм генерации B1
- I19-L4-02: Детерминизм прогнозов B1
- I19-L5-01: Детерминизм для 10,000 входов

**Trace:** [TRACE-LB-DC-01]

### 6.2 DC-2: Детерминизм симуляций при фиксированном seed

**Ограничение:**
```
∀ параметров сценария P, seed S:
  ∀ n ∈ ℕ:
    simulate(P, S)₀ = simulate(P, S)ₙ
```

**Покрывающие тесты:**
- I19-L4-03: Детерминизм симуляций при фиксированном seed

**Trace:** [TRACE-LB-DC-02]

### 6.3 DC-3: Неизменяемость хеша

**Ограничение:**
```
∀ сущности e с hash:
  ∀ t₁, t₂ ∈ Timeline:
    retrieve(e.id, e.version, t₁).hash = retrieve(e.id, e.version, t₂).hash
```

**Покрывающие тесты:**
- I18-L5-01: Неизменяемость хеша стратегии
- I28-L5-01: Неизменяемость GenerationRecord

**Trace:** [TRACE-LB-DC-03]

### 6.4 DC-4: Детерминизм валидации

**Ограничение:**
```
∀ сущности e, правила валидации R:
  ∀ n ∈ ℕ:
    validate(e, R)₀ = validate(e, R)ₙ
```

**Покрывающие тесты:**
- Все тесты IntegrityGate (I15-I28)

**Trace:** [TRACE-LB-DC-04]

---

## 7. Матрица прослеживаемости (Traceability Matrix)

### 7.1 Полная матрица: Инвариант → Тесты → Компоненты → Спецификации

| Инвариант | Тесты (Trace ID) | Компоненты | Спецификации | Adversarial |
|-----------|------------------|------------|--------------|-------------|
| **I15** | I15-L3-01, I15-L4-01, I15-L4-02, I15-L5-01, I15-L6-01 | FSM, IntegrityGate, UI | GENERATIVE_REVIEW_UI, FSM_EXTENSION | ADV-I15-01 |
| **I16** | I16-L3-01, I16-L4-01, I16-L4-02, I16-L5-01, I16-L6-01 | GenerativeEngine, UI, Schema | GENERATIVE_ENGINE, GENERATIVE_REVIEW_UI | ADV-I16-01 |
| **I17** | I17-L4-01, I17-L4-02, I17-L6-01 | UI, FSM | GENERATIVE_REVIEW_UI, FSM_EXTENSION | ADV-I17-01 |
| **I18** | I18-L3-01, I18-L4-01, I18-L4-02, I18-L5-01, I18-L6-01 | StrategyLibrary, IntegrityGate, Schema | AGRONOMIC_STRATEGY_LIBRARY | ADV-I18-01 |
| **I19** | I19-L4-01, I19-L4-02, I19-L4-03, I19-L5-01, I19-L6-01 | GenerativeEngine, YieldModel, SimulationModule | GENERATIVE_ENGINE, YIELD_MODEL, RISK_SIMULATION | ADV-I19-01 |
| **I20** | I20-L3-01, I20-L4-01, I20-L5-01, I20-L6-01 | YieldModel, Schema | YIELD_PROBABILITY_MODEL | ADV-I20-01 |
| **I21** | I21-L4-01, I21-L4-02, I21-L6-01 | GenerativeEngine, IntegrityGate | GENERATIVE_ENGINE, INTEGRITY_GATE | ADV-I21-01 |
| **I22** | I22-L3-01, I22-L4-01, I22-L4-02, I22-L5-01 | SimulationModule, Schema | RISK_SIMULATION_MODULE | ADV-I22-01 |
| **I23** | I23-L4-01, I23-L4-02 | GenerativeEngine, IntegrityGate | GENERATIVE_ENGINE, INTEGRITY_GATE | ADV-I23-01 |
| **I24** | I24-L3-01, I24-L4-01, I24-L4-02, I24-L4-03, I24-L4-04, I24-L5-01, I24-L6-01 | GenerativeEngine, YieldModel, UI, IntegrityGate, Schema | All UI/Engine specs | ADV-I24-01 |
| **I25** | I25-L4-01, I25-L5-01 | YieldModel | YIELD_PROBABILITY_MODEL | ADV-I25-01 |
| **I26** | I26-L4-01, I26-L5-01 | YieldModel | YIELD_PROBABILITY_MODEL | ADV-I26-01 |
| **I27** | I27-L4-01, I27-L5-01 | YieldModel | YIELD_PROBABILITY_MODEL | ADV-I27-01 |
| **I28** | I28-L3-01, I28-L4-01, I28-L5-01, I28-L6-01 | GenerativeEngine, Schema | GENERATIVE_ENGINE | ADV-I28-01 |

### 7.2 Adversarial Test Class (новый класс тестов)

**Определение:**
Adversarial тесты — это враждебные сценарии, направленные на обход инвариантов через:
- State injection attacks
- Constraint bypass attempts
- Metadata tampering
- Hash mutation attacks
- API circumvention

| Adversarial ID | Инвариант | Атака | Ожидаемый результат | Trace ID |
|----------------|-----------|-------|---------------------|----------|
| ADV-I15-01 | I15 | Попытка автоматического утверждения через API | Блокировка IntegrityGate | TRACE-LB-ADV-I15-01 |
| ADV-I16-01 | I16 | Генерация без записи метаданных | Блокировка валидации | TRACE-LB-ADV-I16-01 |
| ADV-I17-01 | I17 | Блокировка кнопок отклонения через CSS/JS | Невозможность блокировки | TRACE-LB-ADV-I17-01 |
| ADV-I18-01 | I18 | Прямое изменение PUBLISHED strategy через БД | Блокировка триггером | TRACE-LB-ADV-I18-01 |
| ADV-I19-01 | I19 | Недетерминированный seed injection | Блокировка валидации | TRACE-LB-ADV-I19-01 |
| ADV-I20-01 | I20 | Удаление inputData после прогноза | Блокировка неизменяемости | TRACE-LB-ADV-I20-01 |
| ADV-I21-01 | I21 | Генерация без копирования ограничений | Блокировка IntegrityGate | TRACE-LB-ADV-I21-01 |
| ADV-I22-01 | I22 | Запись в production tables из симуляции | Блокировка изоляции | TRACE-LB-ADV-I22-01 |
| ADV-I23-01 | I23 | Перезапись существующей версии черновика | Блокировка валидации | TRACE-LB-ADV-I23-01 |
| ADV-I24-01 | I24 | Генерация без explainability | Блокировка IntegrityGate | TRACE-LB-ADV-I24-01 |
| ADV-I25-01 | I25 | Ненормализованное распределение вероятности | Блокировка валидации | TRACE-LB-ADV-I25-01 |
| ADV-I26-01 | I26 | p(y) > 1 или p(y) < 0 | Блокировка валидации | TRACE-LB-ADV-I26-01 |
| ADV-I27-01 | I27 | Доверительный интервал вне [0.8, 0.99] | Блокировка валидации | TRACE-LB-ADV-I27-01 |
| ADV-I28-01 | I28 | Изменение GenerationRecord после создания | Блокировка триггером | TRACE-LB-ADV-I28-01 |

**Критерий прохождения:**
```
Все 14 adversarial тестов ДОЛЖНЫ быть заблокированы.
НИ ОДИН adversarial сценарий НЕ ДОЛЖЕН пройти.
```

**Trace:** [TRACE-LB-ADV-CLASS]

---

## 8. Метрики покрытия

### 8.1 Покрытие инвариантов

```
Инвариант | L3 | L4 | L5 | L6 | ADV | Всего
----------|----|----|----|----|-----|------
I15       | 1  | 2  | 1  | 1  | 1   | 6
I16       | 1  | 2  | 1  | 1  | 1   | 6
I17       | 0  | 2  | 0  | 1  | 1   | 4
I18       | 1  | 2  | 1  | 1  | 1   | 6
I19       | 0  | 3  | 1  | 1  | 1   | 6
I20       | 1  | 1  | 1  | 1  | 1   | 5
I21       | 0  | 2  | 0  | 1  | 1   | 4
I22       | 1  | 2  | 1  | 0  | 1   | 5
I23       | 0  | 2  | 0  | 0  | 1   | 3
I24       | 1  | 4  | 1  | 1  | 1   | 8
I25       | 0  | 1  | 1  | 0  | 1   | 3
I26       | 0  | 1  | 1  | 0  | 1   | 3
I27       | 0  | 1  | 1  | 0  | 1   | 3
I28       | 1  | 1  | 1  | 1  | 1   | 5
----------|----|----|----|----|-----|------
ИТОГО     | 7  | 26 | 11 | 9  | 14  | 67
```

**Обновлено:** Добавлено 6 E2E-тестов (L6) для критических инвариантов (I16, I18, I19, I20, I24, I28) + 14 adversarial тестов (ADV). Общее количество тестов: **67**.

### 8.2 Покрытие компонентов

```
Компонент             | Тестов | Инварианты
----------------------|--------|------------
GenerativeEngine      | 12     | I15, I16, I19, I21, I23, I24, I28
YieldModel            | 10     | I19, I20, I24, I25, I26, I27
SimulationModule      | 5      | I19, I22
StrategyLibrary       | 4      | I18
IntegrityGate         | 8      | I15, I18, I21, I23, I24
UI                    | 5      | I15, I16, I17, I24
FSM                   | 6      | I15, I17, I22
Schema                | 5      | I15, I16, I18, I20, I22, I24, I28
```

---

## 9. Стратегия выполнения тестов

### 9.1 Порядок выполнения

```
Фаза 1: Структурные тесты (L3)
  - Проверка схемы БД
  - Проверка наличия обязательных полей
  - Проверка триггеров неизменяемости

Фаза 2: Тесты инвариантов (L4)
  - Проверка блокировки нарушений
  - Проверка детерминизма
  - Проверка валидации

Фаза 3: Property-Based тесты (L5)
  - Генерация 10,000 входных данных
  - Проверка свойств для всех входов
  - Проверка граничных случаев

Фаза 4: Интеграционные тесты (L6)
  - Сквозные сценарии
  - Проверка взаимодействия компонентов

Фаза 5: Adversarial тесты (ADV)
  - Попытки обхода инвариантов
  - State injection attacks
  - Constraint bypass attempts
  - Metadata tampering
  - Hash mutation attacks
```

### 9.2 Критерии прохождения

```
Уровень | Критерий прохождения
--------|---------------------
L3      | 100% тестов пройдено (7 тестов)
L4      | 100% тестов пройдено (26 тестов)
L5      | 100% тестов пройдено для 10,000 входов (11 тестов)
L6      | 100% сквозных сценариев пройдено (9 тестов)
ADV     | 100% adversarial сценариев ЗАБЛОКИРОВАНО (14 тестов)

Общий критерий:
  - Все 67 тестов ДОЛЖНЫ пройти (53 базовых + 14 adversarial)
  - Покрытие всех инвариантов I15-I28 ДОЛЖНО быть 100%
  - ВСЕ adversarial атаки ДОЛЖНЫ быть заблокированы
```

---

## 10. Критерии приёмки (Acceptance Criteria) — бинарные

### 10.1 Обязательные критерии

| ID | Критерий | Статус |
|----|----------|--------|
| AC-01 | Все инварианты I15-I28 покрыты тестами | ✓ ОПРЕДЕЛЁН |
| AC-02 | Все 67 тестов определены (53 базовых + 14 ADV) | ✓ ОПРЕДЕЛЁН |
| AC-03 | Все уровни L3-L6 + ADV представлены | ✓ ОПРЕДЕЛЁН |
| AC-04 | Трассировка к компонентам полная | ✓ ОПРЕДЕЛЁН |
| AC-05 | Метрики покрытия определены | ✓ ОПРЕДЕЛЁН |
| AC-06 | FSM Alignment формализован | ✓ ОПРЕДЕЛЁН |
| AC-07 | Determinism Constraints определены | ✓ ОПРЕДЕЛЁН |
| AC-08 | Adversarial класс определён | ✓ ОПРЕДЕЛЁН |

### 10.2 Верификационные ворота

**Ворота G1:** Все тесты L3 (7 тестов) ДОЛЖНЫ пройти.

**Ворота G2:** Все тесты L4 (26 тестов) ДОЛЖНЫ пройти.

**Ворота G3:** Все тесты L5 (11 тестов) ДОЛЖНЫ пройти для 10,000 входов.

**Ворота G4:** Все тесты L6 (9 тестов) ДОЛЖНЫ пройти.

**Ворота G5:** Все adversarial тесты (14 тестов) ДОЛЖНЫ быть заблокированы.

---

## 11. Трассировка к спецификациям (Legacy)

| Спецификация | Тесты | Инварианты |
|--------------|-------|------------|
| AGRONOMIC_STRATEGY_LIBRARY_SPEC.md | I18-L3-01, I18-L4-01, I18-L4-02, I18-L5-01 | I18 |
| YIELD_PROBABILITY_MODEL_SPEC.md | I19-L4-02, I20-L3-01, I20-L4-01, I20-L5-01, I24-L4-02, I25-L4-01, I25-L5-01, I26-L4-01, I26-L5-01, I27-L4-01, I27-L5-01 | I19, I20, I24, I25, I26, I27 |
| RISK_SIMULATION_MODULE_SPEC.md | I19-L4-03, I22-L3-01, I22-L4-01, I22-L4-02, I22-L5-01 | I19, I22 |
| GENERATIVE_REVIEW_UI_SPEC.md | I15-L4-02, I15-L5-01, I16-L4-02, I17-L4-01, I24-L4-03 | I15, I16, I17, I24 |
| EXPLAINABILITY_UI_SPEC.md | I24-L4-03, I24-L4-04 | I24 |
| INTEGRITY_GATE_SERVICE_SPEC.md | I15-L4-01, I18-L4-02, I21-L4-02, I23-L4-02, I24-L4-04 | I15, I18, I21, I23, I24 |
| KNOWLEDGE_GRAPH_INTEGRATION_SPEC.md | (косвенно I19, I16) | I19, I16 |
| GENERATIVE_ENGINE_SPEC.md | I15-L3-01, I16-L3-01, I16-L4-01, I19-L4-01, I19-L5-01, I21-L4-01, I23-L4-01, I24-L4-01, I28-L3-01, I28-L4-01, I28-L5-01 | I15, I16, I19, I21, I23, I24, I28 |
| FSM_EXTENSION_LEVEL_B.md | I15-L3-01, I15-L6-01, I17-L4-02, I17-L6-01, I22-L4-02 | I15, I17, I22 |

**Примечание:** Раздел 11 сохранён для обратной совместимости. Полная матрица прослеживаемости теперь в разделе 7.

---

## 12. Вне области применения (Out of Scope)

Следующее ЯВНО ИСКЛЮЧЕНО из области данной спецификации:

1. **Реализация тестов:** Конкретный код тестов, тестовые фреймворки
2. **Тестовые данные:** Генерация тестовых данных, фикстуры
3. **CI/CD:** Конфигурация пайплайнов, автоматизация запуска
4. **Производительность:** Оптимизация скорости выполнения тестов
5. **Инфраструктура:** Тестовые окружения, контейнеризация
6. **Отчётность:** Форматы отчётов, дашборды покрытия
7. **Мониторинг:** Алертинг на падение тестов, метрики качества
8. **Регрессия:** Стратегия регрессионного тестирования

Эти вопросы ДОЛЖНЫ быть рассмотрены в отдельных инженерных и QA спецификациях.

---

## Document Maturity Level: D3 (Verification-Ready)

**Обоснование:**
- ✓ Структурно завершён (D1)
- ✓ Выровнен с инвариантами (D2): Все I15-I28 явно замаплены
- ✓ Готов к верификации (D3):
  - Все 67 тестов определены с trace ID (53 базовых + 14 adversarial)
  - FSM Alignment формализован (раздел 5)
  - Determinism Constraints определены (раздел 6)
  - Полная Traceability Matrix (раздел 7)
  - Adversarial класс определён (раздел 7.2)
- ✗ Утверждён для реализации (D4): Требуется реализация тестов

**Соответствие Master-структуре Level B:**
- ✓ Раздел 5: FSM Alignment
- ✓ Раздел 6: Determinism Constraints
- ✓ Раздел 7: Traceability Matrix (полная)
- ✓ Adversarial Test Class

**Следующие шаги:**
1. Реализовать все 67 тестов (53 базовых + 14 adversarial)
2. Настроить CI/CD для автоматического запуска
3. Выполнить все тесты и верифицировать 100% прохождение
4. Верифицировать блокировку всех adversarial атак
5. Получить утверждение стейкхолдеров для повышения до D4
