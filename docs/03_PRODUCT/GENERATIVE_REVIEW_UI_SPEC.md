# GENERATIVE_REVIEW_UI_SPEC.md

## 0. Статус документа

- **Система:** RAI_Enterprise_Platform
- **Компонент:** Generative Review UI (Level B)
- **Статус:** FORMAL SPECIFICATION
- **Зависимости:** INVARIANT_EXTENSION_FOR_LEVEL_B.md, FSM_EXTENSION_LEVEL_B.md
- **Document Maturity Level:** D3 (Verification-Ready)

---

## 1. Назначение (Purpose)

Данный документ ДОЛЖЕН определить формальную спецификацию пользовательского интерфейса для проверки и утверждения генеративных черновиков в рамках Level B платформы RAI Enterprise Platform. UI ДОЛЖЕН обеспечивать явное человеческое утверждение перехода `GENERATED_DRAFT -> DRAFT`.

Спецификация ДОЛЖНА обеспечить:
- Блокировку автоматического утверждения (I15)
- Верховенство человеческого переопределения (I17)
- Обязательную объяснимость (I24)
- Прослеживаемость провенанса генерации (I16)

---

## 2. Область применения (Scope)

### 2.1 Входит в область

- Формальные требования к UI для состояния `GENERATED_DRAFT`
- Обязательные элементы интерфейса проверки
- Требования к отображению метаданных генерации (I16)
- Требования к отображению объяснимости (I24)
- Контракты взаимодействия с FSM (I15, I17)
- Правила валидации пользовательских действий

### 2.2 Не входит в область (см. Раздел 10)

- Визуальный дизайн (цвета, шрифты, иконки)
- Анимации и переходы
- Адаптивная вёрстка для мобильных устройств
- Производительность рендеринга
- Технологический стек (React, Vue, Angular)
- Библиотеки компонентов
- Accessibility (WCAG)
- Локализация интерфейса

---

## 3. Формальные определения (Formal Definitions)

### 3.1 Обязательные элементы UI

```
GenerativeReviewUI := {
  generationMetadataPanel: MetadataPanel,
  explainabilityPanel: ExplainabilityPanel,
  techMapPreview: TechMapPreview,
  actionButtons: ActionButtons,
  warningBanner: WarningBanner
}
```

### 3.2 MetadataPanel (I16)

```
MetadataPanel MUST display:
  - modelId: String
  - modelVersion: String
  - generatedAt: ISO8601
  - generationStrategy: UUID (с названием стратегии)
  - inputParams: Json (читаемый формат)
  - seed: ℕ | null
```

### 3.3 ExplainabilityPanel (I24)

```
ExplainabilityPanel MUST display:
  - primaryFactors: Factor[]
    ∀ factor:
      - factor.name: String
      - factor.impact: ℝ (визуализация)
      - factor.confidence: ℝ (визуализация)
  - modelRationale: String (текстовое объяснение)
  - confidenceJustification: String
  - limitationsDisclosed: Boolean (MUST be true)
```

### 3.4 ActionButtons (I15, I17)

```
ActionButtons := {
  approveButton: Button,
  rejectButton: Button,
  editButton: Button
}

Constraints:
  - approveButton MUST trigger HUMAN_APPROVE_DRAFT event
  - rejectButton MUST trigger REJECT_GENERATION event
  - editButton MUST transition to manual editing mode
  - Автоматическое нажатие ЗАПРЕЩЕНО (I15)
```

### 3.5 WarningBanner (I15)

```
WarningBanner MUST display:
  "Это генеративный черновик. Требуется явное утверждение человеком.
   Автоматическое утверждение запрещено (I15)."
```

---

## 4. Маппинг инвариантов (Invariant Mapping) — только I15–I28

### 4.1 Покрываемые инварианты

**I15: Изоляция генеративных черновиков**
- **Требование:** Переход `GENERATED_DRAFT -> DRAFT` ДОЛЖЕН требовать явного действия пользователя.
- **Механизм UI:** Кнопка "Утвердить" ДОЛЖНА быть явно нажата пользователем. Автоматическое нажатие, скрипты, API-вызовы без UI ЗАПРЕЩЕНЫ.
- **Trace:** [TRACE-LB-PRODUCT-001]

**I17: Верховенство человеческого переопределения**
- **Требование:** Человек ДОЛЖЕН иметь возможность отклонить или изменить генеративный черновик.
- **Механизм UI:** Кнопки "Отклонить" и "Редактировать" ДОЛЖНЫ быть всегда доступны. Блокировка этих кнопок ЗАПРЕЩЕНА.
- **Trace:** [TRACE-LB-PRODUCT-002]

**I16: Провенанс генерации**
- **Требование:** Метаданные генерации ДОЛЖНЫ быть видимы пользователю.
- **Механизм UI:** `MetadataPanel` ДОЛЖЕН отображать все поля `generationMetadata`.
- **Trace:** [TRACE-LB-PRODUCT-003]

**I24: Обязательная объяснимость**
- **Требование:** Объяснение генерации ДОЛЖНО быть видимо пользователю.
- **Механизм UI:** `ExplainabilityPanel` ДОЛЖЕН отображать все поля `ExplainabilityRecord`.
- **Trace:** [TRACE-LB-PRODUCT-004]

### 4.2 Непокрываемые инварианты

I18, I19, I20, I21, I22, I23, I25, I26, I27, I28 НЕ применимы к данному компоненту UI.

---

## 5. Выравнивание FSM (FSM Alignment)

### 5.1 Поддерживаемые переходы FSM

UI ДОЛЖЕН поддерживать следующие переходы:

```
T1: GENERATED_DRAFT → DRAFT
  Событие: HUMAN_APPROVE_DRAFT
  Триггер UI: Нажатие кнопки "Утвердить"
  Условие: actor.type = 'HUMAN'

T2: GENERATED_DRAFT → ∅
  Событие: REJECT_GENERATION
  Триггер UI: Нажатие кнопки "Отклонить"
  Условие: actor.type = 'HUMAN'

T3: GENERATED_DRAFT → DRAFT (с изменениями)
  Событие: EDIT_DRAFT
  Триггер UI: Нажатие кнопки "Редактировать"
  Эффект: Открыть редактор, сохранить как DRAFT
```

### 5.2 Запрещённые действия (I15)

```
ЗАПРЕЩЕНО:
  - Автоматическое нажатие кнопок
  - API-вызовы без UI (обход интерфейса)
  - Скрипты автоматизации утверждения
  - Переход без явного пользовательского действия
```

**Trace:** [TRACE-LB-PRODUCT-005]

---

## 6. Ограничения детерминизма (Determinism Constraints)

### 6.1 DC-1: Явное пользовательское действие

**Ограничение:**
```
∀ перехода T из GENERATED_DRAFT:
  T ДОЛЖЕН быть инициирован явным действием пользователя в UI
  
Явное действие := {
  click(approveButton) |
  click(rejectButton) |
  click(editButton)
}
```

**Механизм:** UI НЕ ДОЛЖЕН содержать автоматических триггеров (таймеры, auto-submit, скрипты).

**Trace:** [TRACE-LB-PRODUCT-006]

### 6.2 DC-2: Видимость метаданных

**Ограничение:**
```
∀ GENERATED_DRAFT d:
  UI ДОЛЖЕН отображать:
    - generationMetadata (I16)
    - explainability (I24)
  
  ПЕРЕД тем как пользователь может утвердить
```

**Механизм:** Кнопка "Утвердить" МОЖЕТ быть заблокирована до прокрутки панелей метаданных и объяснимости.

**Trace:** [TRACE-LB-PRODUCT-007]

### 6.3 DC-3: Неблокируемость отклонения

**Ограничение:**
```
∀ GENERATED_DRAFT d:
  rejectButton ДОЛЖНА быть всегда активна
  editButton ДОЛЖНА быть всегда активна
```

**Механизм:** Эти кнопки НЕ ДОЛЖНЫ зависеть от условий (прокрутка, таймеры, валидация).

**Trace:** [TRACE-LB-PRODUCT-008]

---

## 7. Стратегия верификации (Verification Strategy)

### 7.1 Структурные тесты (L3)

**Тест:** Проверка наличия обязательных элементов UI
```
Дано: UI для GENERATED_DRAFT
Когда: render(ui)
Тогда: ui.contains(MetadataPanel)
      AND ui.contains(ExplainabilityPanel)
      AND ui.contains(ActionButtons)
      AND ui.contains(WarningBanner)
```
**Trace:** [TRACE-LB-TEST-301]

### 7.2 Тесты формальных инвариантов (L4)

**Тест I15-01:** Блокировка автоматического утверждения
```
Дано: GENERATED_DRAFT d
Когда: попытка автоматического вызова approve() без UI
Тогда: операция ДОЛЖНА быть отклонена с AutoApprovalDeniedException
```
**Trace:** [TRACE-LB-TEST-302]

**Тест I17-01:** Доступность кнопок отклонения и редактирования
```
Дано: UI для GENERATED_DRAFT
Когда: render(ui)
Тогда: ui.rejectButton.enabled = true
      AND ui.editButton.enabled = true
```
**Trace:** [TRACE-LB-TEST-303]

**Тест I16-01:** Видимость метаданных генерации
```
Дано: GENERATED_DRAFT d с generationMetadata
Когда: render(ui, d)
Тогда: ui.MetadataPanel отображает все поля generationMetadata
```
**Trace:** [TRACE-LB-TEST-304]

**Тест I24-01:** Видимость объяснимости
```
Дано: GENERATED_DRAFT d с explainability
Когда: render(ui, d)
Тогда: ui.ExplainabilityPanel отображает все поля explainability
      AND explainability.limitationsDisclosed = true
```
**Trace:** [TRACE-LB-TEST-305]

### 7.3 Тесты на основе свойств (L5)

**Свойство PBT-01:** Невозможность автоматического утверждения
```
Свойство: ∀ GENERATED_DRAFT d:
  ∄ автоматического пути approve(d) без явного UI-действия
Trace: [TRACE-LB-TEST-306]
```

---

## 8. Критерии приёмки (Acceptance Criteria) — бинарные

### 8.1 Обязательные критерии

| ID | Критерий | Статус |
|----|----------|--------|
| AC-01 | I15: Автоматическое утверждение заблокировано | ✓ ОПРЕДЕЛЁН |
| AC-02 | I17: Кнопки отклонения/редактирования доступны | ✓ ОПРЕДЕЛЁН |
| AC-03 | I16: Метаданные генерации видимы | ✓ ОПРЕДЕЛЁН |
| AC-04 | I24: Объяснимость видима | ✓ ОПРЕДЕЛЁН |
| AC-05 | WarningBanner отображается | ✓ ОПРЕДЕЛЁН |
| AC-06 | Все обязательные элементы UI присутствуют | ✓ ОПРЕДЕЛЁН |

### 8.2 Верификационные ворота

**Ворота G1:** Все тесты L4 (TRACE-LB-TEST-301 — TRACE-LB-TEST-305) ДОЛЖНЫ пройти.

**Ворота G2:** Тест PBT-01 ДОЛЖЕН пройти для всех возможных путей взаимодействия.

**Ворота G3:** Ручная проверка UI на соответствие требованиям I15, I17, I16, I24.

---

## 9. Матрица прослеживаемости (Traceability Matrix)

| Trace ID | Тип | Требование | Метод верификации | Статус |
|----------|-----|------------|-------------------|--------|
| TRACE-LB-PRODUCT-001 | Инвариант | I15: Блокировка авто-утверждения | L4 Тест I15-01 | ОПРЕДЕЛЁН |
| TRACE-LB-PRODUCT-002 | Инвариант | I17: Верховенство человека | L4 Тест I17-01 | ОПРЕДЕЛЁН |
| TRACE-LB-PRODUCT-003 | Инвариант | I16: Видимость метаданных | L4 Тест I16-01 | ОПРЕДЕЛЁН |
| TRACE-LB-PRODUCT-004 | Инвариант | I24: Видимость объяснимости | L4 Тест I24-01 | ОПРЕДЕЛЁН |
| TRACE-LB-PRODUCT-005 | FSM | Запрет обхода UI | PBT-01 | ОПРЕДЕЛЁН |
| TRACE-LB-PRODUCT-006 | Ограничение | DC-1: Явное действие | L4 Тест | ОПРЕДЕЛЁН |
| TRACE-LB-PRODUCT-007 | Ограничение | DC-2: Видимость метаданных | L4 Тест | ОПРЕДЕЛЁН |
| TRACE-LB-PRODUCT-008 | Ограничение | DC-3: Неблокируемость отклонения | L4 Тест I17-01 | ОПРЕДЕЛЁН |
| TRACE-LB-TEST-301 | Тест | Наличие элементов UI | Автоматизированный | В ОЖИДАНИИ |
| TRACE-LB-TEST-302 | Тест | I15-01: Блокировка авто | Автоматизированный | В ОЖИДАНИИ |
| TRACE-LB-TEST-303 | Тест | I17-01: Доступность кнопок | Автоматизированный | В ОЖИДАНИИ |
| TRACE-LB-TEST-304 | Тест | I16-01: Метаданные | Автоматизированный | В ОЖИДАНИИ |
| TRACE-LB-TEST-305 | Тест | I24-01: Объяснимость | Автоматизированный | В ОЖИДАНИИ |
| TRACE-LB-TEST-306 | Тест | PBT-01: Нет авто-пути | Property-Based | В ОЖИДАНИИ |

---

## 10. Вне области применения (Out of Scope)

Следующее ЯВНО ИСКЛЮЧЕНО из области данной спецификации:

1. **Визуальный дизайн:** Цветовая схема, типографика, иконки, брендинг
2. **Анимации:** Переходы, эффекты, микроинтеракции
3. **Адаптивность:** Мобильная вёрстка, планшеты, различные разрешения
4. **Производительность:** Оптимизация рендеринга, виртуализация списков
5. **Технологии:** Выбор фреймворка (React/Vue/Angular), библиотек компонентов
6. **Accessibility:** WCAG-соответствие, screen readers, клавиатурная навигация
7. **Локализация:** Перевод на другие языки, RTL-поддержка
8. **Аналитика:** Трекинг действий пользователя, метрики использования

Эти вопросы ДОЛЖНЫ быть рассмотрены в отдельных UI/UX и продуктовых спецификациях.

---

## Document Maturity Level: D3 (Verification-Ready)

**Обоснование:**
- ✓ Структурно завершён (D1)
- ✓ Выровнен с инвариантами (D2): I15, I17, I16, I24 явно замаплены
- ✓ Готов к верификации (D3): Все стратегии тестирования определены с trace ID
- ✗ Утверждён для реализации (D4): Требуется UI/UX дизайн и план реализации

**Следующие шаги:**
1. Создать UI/UX дизайн на основе формальных требований
2. Реализовать тесты L4 и L5
3. Провести ручную проверку соответствия инвариантам
4. Получить утверждение стейкхолдеров для повышения до D4
