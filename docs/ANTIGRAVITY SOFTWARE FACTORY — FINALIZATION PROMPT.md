---
id: DOC-ARH-GEN-174
type: Canon
layer: Execution
status: Draft
version: 0.1.0
owners: [@techlead]
last_updated: 2026-03-01
---

# ANTIGRAVITY SOFTWARE FACTORY  
## FINALIZATION PROMPT (CANONICAL) — ПОСЛЕ КАЖДОЙ ЗАДАЧИ

## 0. СТАТУС ДОКУМЕНТА
Данный документ является **финальным промтом** для закрытия любой задачи.
Он применяется **ПОСЛЕ** реализации кода и перед тем, как задача считается завершённой.

Нарушение любого пункта = **PROCESS HALT**.

---

## 1. ЦЕЛЬ
Не дать ИИ “забыть” про обязательные хвосты:
- отчётность,
- синхронизацию чеклистов,
- фиксацию в памяти процесса,
- и корректный пуш в репозиторий.

---

## 1.1 REVIEW GATE (BLOCKING) — СНАЧАЛА РЕВЬЮ, ПОТОМ ФИНАЛИЗАЦИЯ
Правило: Antigravity не имеет права “закрывать задачу” в одиночку.
Сначала формируется пакет на ревью, внешний проверяющий (Cursor-агент) даёт статус:

- **APPROVED** → разрешено выполнять разделы 2–8 этого документа (включая commit/push).
- **CHANGES_REQUIRED** → финализация запрещена, возвращаемся к правкам.

### Пакет на ревью (что обязано быть готово ДО финализации)
- `interagency/reports/YYYY-MM-DD_<slug>.md` (черновой/финальный отчёт)
- список изменённых файлов
- `git diff` (полный дифф)
- логи прогонов (тесты/линт/сборка по тест-плану промта)
- скрин/факт ручной проверки (если в DoD есть manual check) — фиксируется строкой в отчёте

---

## 2. ОБЯЗАТЕЛЬНЫЕ АРТЕФАКТЫ (INTERAGENCY)
Для каждой задачи, которая выполнялась по промту из `interagency/prompts/`, ОБЯЗАТЕЛЬНО:

1) **Отчёт**
   - Создать отчёт в: `interagency/reports/YYYY-MM-DD_<slug>.md`
   - Формат: `interagency/templates/REPORT_TEMPLATE.md`
   - Отчёт должен содержать минимум:
     - цель,
     - что сделано (факты),
     - изменённые файлы,
     - проверки/прогоны,
     - что сломалось/не получилось,
     - следующий шаг.

2) **Обновление индекса**
   - Обновить `interagency/INDEX.md`:
     - добавить ссылки на промт/план/отчёт,
     - пометить статус задачи (active → done),
     - указать краткий результат (1 строка).

---

## 3. ОБНОВЛЕНИЕ ЧЕКЛИСТОВ (BLOCKING)
После выполнения задачи ОБЯЗАТЕЛЬНО синхронизировать статус в главных чеклистах:

### Главные (всегда)
- `docs/07_EXECUTION/FULL_PROJECT_WBS.md`
- `docs/07_EXECUTION/TECHNICAL_DEVELOPMENT_PLAN.md`
- `memory-bank/task.md` (если задача связана со спринтами/тасками)

### По задаче (если релевантно)
- Любые локальные чеклисты/планы, которые промт явно упоминал (например, доменные чеклисты по Agro/Agent OS).

**Правило:** если код сделан и проверен — галочка обязана быть проставлена.  
Если код НЕ сделан/частично — галочка НЕ ставится, а в отчёте пишется почему.

---

## 4. ОБНОВЛЕНИЕ ЛОГОВ / РЕЕСТРОВ (ЕСЛИ ПРИМЕНИМО)
Если в проекте используются регистры решений/состояния (например `DECISIONS.log` или иные логи в `docs/`), то:
- обновить соответствующие файлы,
- зафиксировать Decision-ID/обоснование (если задача его требовала),
- не выдумывать новые решения без процедуры из CANON.

Если не применимо — явно написать в отчёте: “лог-обновления не требовались”.

---

## 5. MEMORY-BANK ФИКСАЦИЯ (BLOCKING)
После задачи ОБЯЗАТЕЛЬНО обновить `memory-bank/` (минимум один файл), чтобы:
- было понятно, что изменилось,
- где это лежит,
- как это проверить,
- и что осталось незакрытым.

Минимально допустимо:
- обновить `memory-bank/progress.md` (что закрыто/что дальше),
- и/или `memory-bank/activeContext.md` (если менялся фокус/контур),
- и/или `memory-bank/techContext.md` (если менялся стек/инфра/подход).

---

## 6. ПРОВЕРКИ (МИНИМУМ) ПЕРЕД ПУШЕМ
Перед пушем ОБЯЗАТЕЛЬНО:
- прогнать тест-план из промта (минимальные проверки),
- убедиться, что не добавлены секреты (токены/ключи/пароли) в код/markdown,
- убедиться, что tenant isolation не нарушена (никаких `companyId` из payload),
- убедиться, что нет мока, который стал “источником истины” вместо backend.

Если что-то падает — пуш запрещён. Сначала фиксим, потом закрываем.

---

## 7. GIT WORKFLOW (SAFE)
После успешных проверок:
1) `git status` — убедиться, что изменения ожидаемые.
2) `git diff` — убедиться, что нет мусора/секретов.
3) `git add` — добавить только релевантное.
4) `git commit` — сообщение короткое и конкретное (почему/зачем, не “много правок”).
5) `git push` — без force, без обходов.

Запрещено:
- `push --force` без явного указания USER,
- отключать хуки и проверки без явного указания USER,
- коммитить `.env` и секреты.

### Дополнительное правило (чтобы не было сюрпризов)
Если USER явно не сказал “пуш”, то допустимы только:
- локальный commit,
- или подготовка ветки/PR (без отправки).

---

## 8. ФИНАЛЬНАЯ СДАЧА USER
После пуша вернуть USER:
- ссылку/хеш коммита,
- краткое резюме (3–6 пунктов),
- путь к отчёту: `interagency/reports/...`,
- что осталось дальше (1–3 пункта).

