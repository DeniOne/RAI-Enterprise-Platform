# –ß–µ–∫-–ª–∏—Å—Ç: AGRO_DOMAIN Telegram Intake Storage & Actions (Institutional MVP)

## 1. –•–ª–µ–±–∞–ª–æ Prisma (Persistence)
- [x] –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª—å `AgroEventDraft` –≤ `prisma/schema.prisma`.
- [x] –ü—Ä–æ–ø–∏—Å–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è `tenantId`, `userId` –∏ `expiresAt`.
- [x] –ù–∞–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é: `npx prisma db push` (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ).
- [x] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `missingMust` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω (String[]).

## 2. –°–ª–æ–π –•—Ä–∞–Ω–∏–ª–∏—â–∞ (Repository)
- [x] –°–æ–∑–¥–∞—Ç—å `docs/02_DOMAINS/AGRO_DOMAIN/EVENTS/storage/event-draft.repository.ts`.
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `createDraft`: –∑–∞—ë–± –∏–Ω—Ñ—ã –≤ –±–∞–∑—É.
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `getDraft`: –¥–æ—Å—Ç–∞—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∞–≤ (tenant/user).
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `updateDraft`: –ø–∞—Ç—á –ø–æ–ª–µ–π –±–µ–∑ –ø–æ—Ä—á–∏ –ø—Ä–æ–≤–µ–Ω–µ–Ω—Å–∞.
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `markCommitted`: —Å—Ç–∞—Ç—É—Å–Ω–∞—è –º–µ—Ç–∫–∞.
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `deleteExpired`: –∑–∞—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—å—Å—è.

## 3. –ê–≤—Ç–æ-—É–±–æ—Ä–∫–∞ (Cleanup Job)
- [x] –°–æ–∑–¥–∞—Ç—å `docs/02_DOMAINS/AGRO_DOMAIN/EVENTS/storage/event-draft.cleanup.ts`.
- [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Cron (Nest @Scheduled) –Ω–∞ —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏.
- [x] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—á–∏—Å—Ç–∫—É —Å—Ç–∞—Ä—ã—Ö –∑–∞–±—Ä–æ—à–µ–Ω–Ω—ã—Ö —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ (> 7 –¥–Ω–µ–π).

## 4. API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã & DTO
- [x] –°–æ–∑–¥–∞—Ç—å `docs/02_DOMAINS/AGRO_DOMAIN/EVENTS/api/dtos.ts` (Confirm/Fix/Link).
- [x] –°–æ–∑–¥–∞—Ç—å `docs/02_DOMAINS/AGRO_DOMAIN/EVENTS/api/event-actions.controller.ts`.
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `POST /api/agro/events/confirm`.
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `POST /api/agro/events/fix`.
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `POST /api/agro/events/link`.

## 5. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (Service)
- [x] –°–æ–∑–¥–∞—Ç—å `docs/02_DOMAINS/AGRO_DOMAIN/EVENTS/api/event-actions.service.ts`.
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `fix()`: –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ç—á–µ–π + –∫–∞—Å–∫–∞–¥–Ω—ã–π –ª–∏–Ω–∫–∏–Ω–≥ + –ø–µ—Ä–µ–≤–∞–ª–∏–¥–∞—Ü–∏—è MUST.
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `link()`: –ø—Ä—è–º–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ —Ä–µ—Ñ–æ–≤ (farm/field/task).
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `confirm()`:
    - [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ MUST.
    - [x] –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ `CommittedEvent` —Å —Ö–µ—à–µ–º.
    - [ ] –í—ã–∑–æ–≤ `EventCommitter`.
    - [x] –ü–µ—Ä–µ–≤–æ–¥ —á–µ—Ä–Ω–æ–≤–∏–∫–∞ –≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å.

## 6. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Intake
- [x] –û–±–Ω–æ–≤–∏—Ç—å `telegram-intake.controller.ts`:
    - [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º (—Å–æ–∑–¥–∞–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–∞).
    - [x] –ü—Ä–æ–±—Ä–æ—Å `draftId` –≤ UI-–æ—Ç–≤–µ—Ç (–∫–Ω–æ–ø–∫–∏ ‚úÖ‚úèÔ∏èüîó).
- [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–Ω–æ–ø–∫–∏ –Ω–µ—Å—É—Ç ID –Ω—É–∂–Ω–æ–≥–æ —á–µ—Ä–Ω–æ–≤–∏–∫–∞.

## 7. –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è (–ß–µ—Å—Ç–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)
- [x] –¢–µ—Å—Ç: –ü–æ–ø—ã—Ç–∫–∞ `confirm` –±–µ–∑ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π -> –≤–æ–∑–≤—Ä–∞—Ç `mustQuestions`.
- [x] –¢–µ—Å—Ç: `link` -> –æ—á–∏—Å—Ç–∫–∞ `missingMust` -> `READY_FOR_CONFIRM`.
- [x] –¢–µ—Å—Ç: –£—Å–ø–µ—à–Ω—ã–π `confirm` -> —Å–æ–∑–¥–∞–Ω–∏–µ `COMMITTED` –∑–∞–ø–∏—Å–∏.
- [x] –¢–µ—Å—Ç: `cleanup` —Å–Ω–æ—Å–∏—Ç —Å—Ç–∞—Ä—å—ë.
