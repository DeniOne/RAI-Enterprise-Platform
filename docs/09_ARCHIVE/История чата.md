План в целом очень сильный: идея “сквозного AI-канала” + “росток→чат” отлично ложится на RAI как institutional control plane. Ниже — что стоит усилить/починить, чтобы это было 10/10 по архитектуре, UX и управляемости.

Решение по ключевому спору: overlay-панель, не отдельная страница

Делаем overlay + панель, а не /ai-chat как отдельный роут.

Эффект:

пользователь не теряет контекст и может параллельно работать (это критично для операционного интерфейса),

анимация становится детерминированной (без race-condition роутинга),

чат превращается в “инструмент управления”, а не “переход на другую страницу”.

Роут /api/ai-chat оставляем как API-эндпоинт. Страницу /ai-chat можно оставить как dev/diagnostics или “полноэкранный режим” позже, но MVP — overlay.

Архитектурные правки, чтобы это было institutional-grade
1) Два режима чата: Global + Contextual

Global Chat — общий помощник.
Contextual Chat — чат, который автоматически подмешивает контекст текущей страницы (entityId, tenantId, module, read-model snapshot id).

Действие: в ai-chat-store добавить context:

route, moduleKey

selectedEntityRefs (например, поле/хоз-во/контрагент)

readModelVersion / snapshotHash (если уже есть снапшоты)

Эффект: ответы становятся привязанными к текущей операции, меньше “болтовни”, больше управляемых действий.

2) Безопасность и governance: чат — это “вход” в высокорисковую систему

Чат нельзя делать “просто UI”. Он должен быть под теми же принципами, что Phase 4–6.

Действие:

Любой “action suggestion” от ассистента маркируется riskLevel (R0–R4) и requiresQuorum (true/false).

Для R3/R4 — только draft/предложение, выполнение через существующий Governance/Quorum flow.

Логировать: promptHash, contextHash, assistantAnswerHash, modelVersion, policyVersion.

Эффект: чат становится безопасным и аудируемым, не ломает institutional guarantees.

3) UI Canon: не “кислотная FAB”, а управляемая “институциональная кнопка”

Твой вариант с градиентом emerald/teal + pulse — эффектный, но есть риск выбиться из “брюталистского governance-first” канона.

Действие (сохранить “росток”, но приземлить под канон):

FAB: нейтральный корпус (светлый/графитовый), росток — акцент, но без “неоновой игрушки”.

Pulse — очень мягкий и редкий (или только при “AI has suggestion / unread”).

Hover “покачивание” — ок, но амплитуда минимальная.

Эффект: выглядит “премиально и строго”, не превращает систему в “маркетинговый SaaS”.

4) Анимация: не route-transition — согласен, но важно сделать “обратимость” и “состояния”

У тебя уже есть 3 фазы. Добавь явный FSM для анимации, а не “набор таймеров”.

Действие: состояния overlay:

closed → sprout_grow → sprout_expand → morph_to_panel → open

обратная цепочка при закрытии

события: OPEN, CLOSE, ESC, ROUTE_CHANGE (важно)

Эффект: исчезают глитчи при быстрых кликах/смене страниц, поведение становится детерминированным.

5) UX детали, которые резко повышают “ощущение продукта”

Действие:

Esc закрывает overlay

Ctrl/Cmd + K открывает чат (как command-панель)

Фокус-ловушка (focus trap) внутри панели

Автоскролл ленты только если пользователь не скроллил вверх (иначе не “дёргать”)

Empty state: “Я вижу, что ты на странице X. С чем помочь?” (без воды)

Эффект: ощущается как операторский инструмент, а не “чатик”.

Технические уточнения по твоим пунктам
framer-motion

Норм. 50KB gzip — приемлемо.
Действие: грузить overlay/анимацию лениво (dynamic import) и рендерить только когда isOpen || isAnimating.
Эффект: нулевой overhead на страницах, где чат не трогают.

Zustand store

Добавь:

threadId (позже пригодится под серверные треды)

persist только для messages (и то с лимитом 50–100 сообщений)

abortController для отмены запроса при закрытии

Эффект: меньше утечек, стабильнее UX.

API mock

Супер, но сразу заложи контракт:

POST /api/ai-chat { threadId, message, context }

ответ: { assistantMessage, citations?, riskLevel?, suggestedActions? }

Эффект: ты не переписываешь UI, когда подключишь реального агента.

Что поправить в структуре компонентов (чтобы не было каши)

Текущее разбиение ок, но лучше так:

AiChatRoot (подключается в layout.tsx)

AiChatFab

AiChatOverlay (лениво)

SproutMorphAnimation

AiChatPanel

Эффект: единая точка входа, проще тестировать и поддерживать.

Verification Plan: дополни обязательными проверками

Добавь к твоему списку:

Race tests

быстрый double-click по FAB

открыть и тут же закрыть во время 1/2/3 фазы

смена route во время анимации

A11y

tab-cycle не уходит за пределы панели

aria-label на кнопках

корректный фокус на input после открытия

Governance compatibility

сообщения и действия не обходят RiskGate/Quorum

логи/хэши пишутся (или хотя бы события telemetry)

Эффект: это реально institutional, а не “красивая игрушка”.

Самое важное улучшение (одно действие, максимум эффекта)

Сделай FSM-управление анимацией + контекстный payload в запросе.

Эффект:

анимация становится железобетонной,

чат начинает работать как “операционный помощник в конкретной странице”,

дальнейшее подключение настоящего агента происходит без рефакторинга UI.