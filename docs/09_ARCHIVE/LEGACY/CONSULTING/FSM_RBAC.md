---
id: DOC-ARH-GEN-181
type: Legacy
layer: Archive
status: Draft
version: 0.1.0
owners: [@techlead]
last_updated: 2026-02-15
---

# FSM + RBAC Matrix: Статус: CANONICAL CONTEXT
**Область применения:** UI, API, бизнес-логика, контроль прав доступа

## 0. Назначение документа

Документ отвечает на вопрос:

**КТО и ЧТО может делать в КАКОМ статусе объекта**

*   **FSM** защищает систему от логического хаоса
*   **RBAC** защищает от несанкционированных действий

⚠️
> **RBAC без FSM → опасно**
> **FSM без RBAC → бесполезно**

## 1. Роли (упрощённая каноническая модель)

Используются 4 базовые роли:

1.  **Администратор**
2.  **Владелец / CEO**
3.  **Менеджер**
4.  **Агроном (штатный)**

## 2. Канонические сущности с FSM

FSM применяется только к сущностям, влияющим на результат:

*   Хозяйство
*   План Урожая
*   Техкарта Урожая
*   Исполнение Техкарты
*   Отклонение
*   Решение (Decision Record)
*   Расчёт Результата / Эффекта

## 3. FSM + RBAC: Хозяйство (CRM)

**Статусы:**
`Черновик` → `Активное` → `Архив`

| Действие \ Роль | Админ | CEO | Менеджер | Агроном |
| :--- | :--- | :--- | :--- | :--- |
| **Создание** | ✔ | – | ✔ | – |
| **Редактирование** | ✔ | – | ✔ | – |
| **Просмотр** | ✔ | ✔ | ✔ | ✔ (огр.) |
| **Архивация** | ✔ | ✔ | – | – |

## 4. FSM + RBAC: План Урожая

**Статусы:**
`Черновик` → `На согласовании` → `Утверждён` → `Активен` → `Завершён` → `Архив`

| Действие | Админ | CEO | Менеджер | Агроном |
| :--- | :--- | :--- | :--- | :--- |
| **Создание (Черновик)** | ✔ | – | ✔ | – |
| **Редактирование (Черновик)** | ✔ | – | ✔ | – |
| **Просмотр** (любой статус) | ✔ | ✔ | ✔ | ✔ |
| **Утверждение** | – | ✔ | – | – |
| **Активация** | – | ✔ | – | – |
| **Завершение** | – | ✔ | – | – |

❗ **После статуса «Активен»:**
1.  редактирование запрещено
2.  допускаются только отклонения

## 5. FSM + RBAC: Техкарта Урожая

**Статусы:**
`Проект` → `Проверка` → `Активна` → `Заморожена` → `Архив`

| Действие | Админ | CEO | Менеджер | Агроном |
| :--- | :--- | :--- | :--- | :--- |
| **Проектирование** | – | – | – | ✔ |
| **Редактирование** (до «Активна») | – | – | – | ✔ |
| **Просмотр** (любой статус) | ✔ | ✔ | ✔ | ✔ |
| **Активация** | – | ✔ | – | – |
| **Заморозка** | – | ✔ | – | – |

❗ **Замороженная техкарта:**
1.  не редактируется
2.  используется как эталон

## 6. FSM + RBAC: Исполнение Техкарты

**Статусы:**
`Запланировано` → `В работе` → `Завершено` → `Зафиксировано`

| Действие | Менеджер | Агроном |
| :--- | :--- | :--- |
| **Создание задач** | ✔ | – |
| **Фиксация факта** | ✔ | – |
| **Консультирование** | – | ✔ |
| **Контроль допущений** | – | ✔ |

## 7. FSM + RBAC: Отклонение

**Статусы:**
`Выявлено` → `На разборе` → `Решение принято` → `Закрыто`

| Действие | Админ | CEO | Менеджер | Агроном |
| :--- | :--- | :--- | :--- | :--- |
| **Инициация** | – | – | ✔ | ✔ |
| **Анализ** | – | – | ✔ | ✔ |
| **Принятие решения** | – | ✔ | – | – |
| **Закрытие** | – | ✔ | – | – |

## 8. FSM + RBAC: Решение (Decision Record)

**Статус:**
`Зафиксировано` (финальное)

| Роль | Доступ |
| :--- | :--- |
| Администратор | Просмотр |
| CEO | Создание / Просмотр |
| Менеджер | Просмотр |
| Агроном | Просмотр |

❗ **Решение:**
1.  не редактируется
2.  не удаляется
3.  юридически и экономически значимо

## 9. FSM + RBAC: Результат и Эффект

**Статусы:**
`Черновик` → `Рассчитан` → `Зафиксирован` → `Закрыт`

| Действие \ Роль | Админ | CEO | Менеджер | Агроном |
| :--- | :--- | :--- | :--- | :--- |
| **Просмотр** | ✔ | ✔ | ✔ (свои) | ✔ (без экономики) |
| **Фиксация** | – | ✔ | – | – |
| **Закрытие периода** | – | ✔ | – | – |

## 10. Золотые правила FSM + RBAC

1.  **Нельзя перепрыгивать статусы**
2.  **Права меняются при смене статуса**
3.  **Активный объект не редактируется**
4.  **Решение необратимо**
5.  **Экономика появляется только после фиксации результата**

## 11. Каноническая формула

*   **FSM** определяет — **ЧТО** можно делать
*   **RBAC** определяет — **КТО** может это делать
*   **Вместе они защищают результат**
