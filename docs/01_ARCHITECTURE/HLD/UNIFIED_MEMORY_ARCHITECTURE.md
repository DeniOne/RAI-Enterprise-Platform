---
id: DOC-ARC-GEN-042
type: HLD
layer: Architecture
status: Draft
version: 0.1.0
owners: [@techlead]
last_updated: 2026-02-15
---

---
id: component-uma
type: component
status: review
owners: [architects]
aligned_with: [principle-axioms]
---

# HLD: Unified Memory Architecture (The RAI Brain) üß†

> **–°—Ç–∞—Ç—É—Å:** –ö–æ–Ω—Ü–µ–ø—Ç | **–§–∞–∑–∞:** Gamma/Delta | **–°–ª–æ–π:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ / HLD

---

## 1. –§–∏–ª–æ—Å–æ—Ñ–∏—è: "–°–∏—Å—Ç–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–º–Ω–∏—Ç –≤—Å—ë"

–ú—ã —É—Ö–æ–¥–∏–º –æ—Ç –ø–æ–Ω—è—Ç–∏—è –ø—Ä–æ—Å—Ç–æ–π "–ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö" –∫ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ **–ö–æ–≥–Ω–∏—Ç–∏–≤–Ω–æ–π –ü–∞–º—è—Ç–∏**. –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –æ–±–ª–∞–¥–∞—Ç—å —Å–≤–æ–π—Å—Ç–≤–∞–º–∏ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π –ø–∞–º—è—Ç–∏:
1.  **–ú–Ω–æ–≥–æ–º–µ—Ä–Ω–æ—Å—Ç—å**: –°–≤—è–∑–∏ "–º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º" (–ì—Ä–∞—Ñ).
2.  **–ê—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å**: –ü–æ–∏—Å–∫ –Ω–µ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º, –∞ –ø–æ —Å–º—ã—Å–ª—É (–í–µ–∫—Ç–æ—Ä—ã).
3.  **–ü–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å**: –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∑–∞–ø–æ–º–∏–Ω–∞—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã —Å—É—â–Ω–æ—Å—Ç–µ–π –±–µ–∑ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è –∫–æ–¥–∞ (Self-Expanding Schema).
4.  **–†–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –≤—Å–ø–ª—ã–≤–∞–Ω–∏–µ "–æ–ø–∞—Å–Ω—ã—Ö –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π" (–≠–Ω–≥—Ä–∞–º–º—ã).

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: "Memory Onion" (–°–ª–æ–∏ –ü–∞–º—è—Ç–∏)

–°–∏—Å—Ç–µ–º–∞ –ø–∞–º—è—Ç–∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 5 —Å–ª–æ–µ–≤, –æ—Ç "–≥–æ—Ä—è—á–µ–π" (–±—ã—Å—Ç—Ä–æ–π –∏ –∫–æ—Ä–æ—Ç–∫–æ–π) –¥–æ "—Ö–æ–ª–æ–¥–Ω–æ–π" (–∞—Ä—Ö–∏–≤–Ω–æ–π –∏ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π).

```mermaid
graph TD
    %% –í—Ö–æ–¥–Ω–æ–π –∑–∞–ø—Ä–æ—Å
    Input[üîç Query / Context] --> Router{Memory Router}

    %% –°–ª–æ–π 1: Working Memory (–ì–æ—Ä—è—á–∞—è)
    Router -->|Context Window| WM[üî• Working Memory<br/>(Redis/Session)]
    
    %% –°–ª–æ–π 2: Semantic Memory (–ì—Ä–∞—Ñ)
    Router -->|Relationships/Facts| KG[üï∏Ô∏è Semantic Memory<br/>(Knowledge Graph / Neo4j)]
    
    %% –°–ª–æ–π 3: Episodic Memory (–≠–Ω–≥—Ä–∞–º–º—ã)
    Router -->|Experience/Similarity| Engram[‚ö° Episodic Memory<br/>(Engrams / pgvector)]
    
    %% –°–ª–æ–π 4: External Memory (RAG)
    Router -->|Docs/Regulations| RAG[üìö External Memory<br/>(Document Store / Weaviate)]

    %% –°–ª–æ–π 5: Procedural Memory (–ù–∞–≤—ã–∫–∏)
    Router -->|How-to/Tools| Skill[üõ†Ô∏è Procedural Memory<br/>(Function Registry)]

    %% –°–∏–Ω—Ç–µ–∑ –æ—Ç–≤–µ—Ç–∞
    WM & KG & Engram & RAG & Skill --> Synthesizer[üß† Context Synthesizer]
    Synthesizer --> Output[üí° Intelligent Response]
```

---

## 3. –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –°–ª–æ–µ–≤

### 3.1 üî• Working Memory (–†–∞–±–æ—á–∞—è –ü–∞–º—è—Ç—å)
**–ê–Ω–∞–ª–æ–≥:** –û–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–º—è—Ç—å —É —á–µ–ª–æ–≤–µ–∫–∞.
*   **–ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç:** –¢–µ–∫—É—â–∏–π –¥–∏–∞–ª–æ–≥, –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏, –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º—ã–π "–ø—Ä—è–º–æ —Å–µ–π—á–∞—Å" –∫–æ–Ω—Ç–µ–∫—Å—Ç (–∫–∞—Ä—Ç–∞ –ø–æ–ª—è).
*   **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** Redis, In-Memory Context Window.
*   **–°—Ä–æ–∫ –∂–∏–∑–Ω–∏:** –°–µ—Å—Å–∏—è –∏–ª–∏ –ó–∞–¥–∞—á–∞.

### 3.2 üï∏Ô∏è Semantic Memory (–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –ü–∞–º—è—Ç—å / –ì—Ä–∞—Ñ –ó–Ω–∞–Ω–∏–π)
**–ê–Ω–∞–ª–æ–≥:** –≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞–Ω–∏—è ("–ü—à–µ–Ω–∏—Ü–∞ ‚Äî —ç—Ç–æ –∫—É–ª—å—Ç—É—Ä–∞", "–ü–æ–ª–µ 5 –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –•–æ–∑—è–π—Å—Ç–≤—É –ê").
*   **–¶–µ–ª—å:** –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–≤—è–∑–µ–π "–º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º".
*   **Self-Expanding:** –ï—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç –Ω–æ–≤—É—é —Å—É—â–Ω–æ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–î—Ä–æ–Ω-–æ–ø—Ä—ã—Å–∫–∏–≤–∞—Ç–µ–ª—å"), –æ–Ω–∞ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —É–∑–µ–ª –≤ –≥—Ä–∞—Ñ–µ –∏ —Å–≤—è–∑–∏, –Ω–µ –ª–æ–º–∞—è —Å—Ç–∞—Ä—É—é —Å—Ö–µ–º—É.
*   **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** Neo4j (Graph DB) –∏–ª–∏ PostgreSQL (Recursive Queries + JSONB).
*   **GraphRAG:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑–µ–π –≥—Ä–∞—Ñ–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞. "–ù–∞–π–¥–∏ –≤—Å–µ –ø–æ–ª—è, –≥–¥–µ —Ä–æ—Å–ª–∞ –ø—à–µ–Ω–∏—Ü–∞ –ø–æ—Å–ª–µ –ø–æ–¥—Å–æ–ª–Ω–µ—á–Ω–∏–∫–∞".

### 3.3 ‚ö° Episodic Memory (–≠–Ω–≥—Ä–∞–º–º—ã / –û–ø—ã—Ç)
**–ê–Ω–∞–ª–æ–≥:** –õ–∏—á–Ω—ã–π –æ–ø—ã—Ç ("–í –ø—Ä–æ—à–ª–æ–º –≥–æ–¥—É –Ω–∞ —ç—Ç–æ–º –ø–æ–ª–µ —Å–≥–æ—Ä–µ–ª —É—Ä–æ–∂–∞–π –∏–∑-–∑–∞ –∑–∞—Å—É—Ö–∏").
*   **–ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç:** Positive (+) –∏ Negative (-) –∫–µ–π—Å—ã, –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã, —Ä–µ—à–µ–Ω–∏—è.
*   **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** PostgreSQL + pgvector (–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫).
*   **–ú–µ—Ö–∞–Ω–∏–∑–º:** –†–µ–∞–∫—Ç–∏–≤–Ω—ã–π. –í—Å–ø–ª—ã–≤–∞–µ—Ç —Å–∞–º–æ –∫–∞–∫ "–ø—Ä–µ–¥—á—É–≤—Å—Ç–≤–∏–µ" –∏–ª–∏ –∞–ª–µ—Ä—Ç.

### 3.4 üìö External Memory (RAG / –î–æ–∫—É–º–µ–Ω—Ç—ã)
**–ê–Ω–∞–ª–æ–≥:** –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∫–Ω–∏–≥ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π.
*   **–ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç:** PDF-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∫ —Ç–µ—Ö–Ω–∏–∫–µ, –∑–∞–∫–æ–Ω—ã, –Ω–∞—É—á–Ω—ã–µ —Å—Ç–∞—Ç—å–∏, —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏.
*   **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** Vector DB (Weaviate/Chroma/pgvector).
*   **–ú–µ—Ö–∞–Ω–∏–∑–º:** –ü–æ–∏—Å–∫ —á–∞–Ω–∫–æ–≤ —Ç–µ–∫—Å—Ç–∞ –ø–æ —Å–º—ã—Å–ª—É –∏ —Å–∫–∞—Ä–º–ª–∏–≤–∞–Ω–∏–µ –∏—Ö LLM –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞.

### 3.5 üõ†Ô∏è Procedural Memory (–ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∞—è –ü–∞–º—è—Ç—å)
**–ê–Ω–∞–ª–æ–≥:** –ú—ã—à–µ—á–Ω–∞—è –ø–∞–º—è—Ç—å ("–ö–∞–∫ –≤–æ–¥–∏—Ç—å –º–∞—à–∏–Ω—É").
*   **–ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç:** –°—Ü–µ–Ω–∞—Ä–∏–∏ (Workflows), –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (Tools), —Å–∫—Ä–∏–ø—Ç—ã Python.
*   **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** Function Registry, Code Interpreter scripts.

---

## 4. –ü—Ä–∏–º–µ—Ä "–í—Å–ø—ã—à–∫–∏ –ü–∞–º—è—Ç–∏" (Memory Flash)

**–ó–∞–ø—Ä–æ—Å –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:** *"–ü–æ—á–µ–º—É –Ω–∞ –ø–æ–ª–µ '–í–æ—Å—Ö–æ–¥-2' –∂–µ–ª—Ç–µ—é—Ç –ª–∏—Å—Ç—å—è?"*

1.  **Working Memory:** –ü–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –º—ã –≥–æ–≤–æ—Ä–∏–º –ø—Ä–æ "–í–æ—Å—Ö–æ–¥-2" –≤ —Ç–µ–∫—É—â–µ–º —Å–µ–∑–æ–Ω–µ 2026.
2.  **Semantic Memory (Graph):**
    *   –ù–∞—Ö–æ–¥–∏—Ç –Ω–æ–¥—É `Field: "–í–æ—Å—Ö–æ–¥-2"`.
    *   –í–∏–¥–∏—Ç —Å–≤—è–∑—å `CurrentCrop: "Winter Wheat (–ï—Ä–º–∞–∫)"`.
    *   –í–∏–¥–∏—Ç —Å–≤—è–∑—å `LastOperation: "Herbicide Application (3 days ago)"`.
3.  **Episodic Memory (Engram):**
    *   –ò—â–µ—Ç –≤–µ–∫—Ç–æ—Ä—ã: "Wheat yellowing herbicide".
    *   **FLASH!** –ù–∞—Ö–æ–¥–∏—Ç –∏–Ω—Ü–∏–¥–µ–Ω—Ç 2024 –≥–æ–¥–∞: "–û–∂–æ–≥ –ª–∏—Å—Ç–∞ –∏–∑-–∑–∞ —Å–º–µ—à–∏–≤–∞–Ω–∏—è –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞ X –∏ Y –ø—Ä–∏ t > 25¬∞C".
4.  **External Memory (RAG):**
    *   –ü–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –∫ –≥–µ—Ä–±–∏—Ü–∏–¥—É: "–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –Ω–µ –ø—Ä–∏–º–µ–Ω—è—Ç—å –ø—Ä–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ –≤—ã—à–µ 25¬∞C".
5.  **–°–∏–Ω—Ç–µ–∑:**
    *   –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–≥–æ–¥—É (Context). –ë—ã–ª–æ +27¬∞C.
    *   **–û—Ç–≤–µ—Ç:** "–ï—Å—Ç—å –≤—ã—Å–æ–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ö–∏–º–∏—á–µ—Å–∫–æ–≥–æ –æ–∂–æ–≥–∞. 3 –¥–Ω—è –Ω–∞–∑–∞–¥ –≤–Ω–æ—Å–∏–ª–∏ –≥–µ—Ä–±–∏—Ü–∏–¥ –ø—Ä–∏ +27¬∞C, –∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∑–∞–ø—Ä–µ—â–∞–µ—Ç —Ä–∞–±–æ—Ç—É –≤—ã—à–µ +25¬∞C. –£ –Ω–∞—Å –±—ã–ª –ø–æ—Ö–æ–∂–∏–π —Å–ª—É—á–∞–π –≤ 2024 –≥–æ–¥—É (–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å 89%)."

---

## 5. Self-Expanding Mechanism (–°–∞–º–æ—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)

–ö–∞–∫ —Ö—Ä–∞–Ω–∏—Ç—å "–Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ —Ç–∏–ø–æ–≤"?

–ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ **Graph + Document Store**:
1.  **Core Entities:** –ñ–µ—Å—Ç–∫–∞—è —Å—Ö–µ–º–∞ –≤ SQL (User, Field, Task) –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏.
2.  **Flexible Knowledge:** –ì—Ä–∞—Ñ (Nodes & Edges) –¥–ª—è –≤—Å–µ–≥–æ –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ.
    *   `Node(ID, Type="Drone", Properties={...})`
    *   `Edge(FromID, ToID, Relation="ASSIGNED_TO")`
3.  **Semantic Extractor:**
    *   –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç PDF "–ù–æ–≤—ã–π —Ç–∏–ø –¥–∞—Ç—á–∏–∫–∞ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏", AI-–∞–≥–µ–Ω—Ç –ø–∞—Ä—Å–∏—Ç –µ–≥–æ –∏ —Å–∞–º —Å–æ–∑–¥–∞–µ—Ç:
        *   –ù–æ–≤—ã–π —Ç–∏–ø Node `SensorType: HumidityBrandX`
        *   –ù–æ–≤—ã–µ —Å–≤—è–∑–∏ —Å –ø–æ–ª—è–º–∏.
    *   –ë–µ–∑ —É—á–∞—Å—Ç–∏—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞.

---

## 6. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –°—Ç–µ–∫ (Target Architecture)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ü–∞–º—è—Ç–∏ | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –†–æ–ª—å |
| :--- | :--- | :--- |
| **Hot Cache** | **Redis** | –°–µ—Å—Å–∏–∏, –∫–æ–Ω—Ç–µ–∫—Å—Ç, –∫—ç—à –≥—Ä–∞—Ñ–∞ |
| **Vectors** | **pgvector / Qdrant** | –≠–Ω–≥—Ä–∞–º–º—ã, RAG —á–∞–Ω–∫–∏ |
| **Graph** | **Neo4j / Apache Age** | –°–ª–æ–∂–Ω—ã–µ —Å–≤—è–∑–∏, –æ–Ω—Ç–æ–ª–æ–≥–∏—è |
| **Relational** | **PostgreSQL** | –§—É–Ω–¥–∞–º–µ–Ω—Ç, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –±–∏–ª–ª–∏–Ω–≥ |
| **Blob Storage** | **S3 / MinIO** | –ò—Å—Ö–æ–¥–Ω–∏–∫–∏ —Ñ–∞–π–ª–æ–≤ (PDF, IMG) |

### üöÄ Performance Strategy
–î–ª—è "–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±—ã—Å—Ç—Ä–æ–π –≤—ã–¥–∞—á–∏":
1.  **Tiered Retrieval:** –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º Redis (1ms) -> –ü–æ—Ç–æ–º –í–µ–∫—Ç–æ—Ä—ã (50ms) -> –ü–æ—Ç–æ–º –ì—Ä–∞—Ñ (100ms).
2.  **Async RAG:** –î–æ–∫—É–º–µ–Ω—Ç—ã –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è —Ñ–æ–Ω–æ–≤–æ.
3.  **Parallel Execution:** –ü–æ–∏—Å–∫ –≤ –ì—Ä–∞—Ñ–µ –∏ –í–µ–∫—Ç–æ—Ä–∞—Ö –∏–¥–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (—Å–º. –¥–∏–∞–≥—Ä–∞–º–º—É).

---

## 7. –≠—Ç–∞–ø—ã –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

1.  **Phase Alpha (–°–µ–π—á–∞—Å):** `PostgreSQL` (Relational) + `Redis`.
2.  **Phase Beta:** –î–æ–±–∞–≤–ª—è–µ–º `pgvector` (RAG –¥–ª—è –¥–æ–∫–æ–≤ + –ø—Ä–æ—Å—Ç—ã–µ –≠–Ω–≥—Ä–∞–º–º—ã).
3.  **Phase Gamma:** –í–Ω–µ–¥—Ä—è–µ–º `Graph DB` (–°–ª–æ–∂–Ω—ã–µ —Å–≤—è–∑–∏) + Self-Expanding Schema.
