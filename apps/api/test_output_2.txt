FAIL src/modules/generative-engine/record/generation-record.service.spec.ts (36.187 s)
  GenerationRecordService
    createRecord
      Ã— Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÑ‚ÑŒ Ñ†ÐµÐ»Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ Ñ‡ÐµÑ€ÐµÐ· gate Ð¿ÐµÑ€ÐµÐ´ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸ÐµÐ¼ (134 ms)
      Ã— Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð´ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ‚Ð¾Ð² (P2002) (24 ms)
    verifyRecordIntegrity
      Ã— Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð´ÐµÐ»ÐµÐ³Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ gate (17 ms)

  â— GenerationRecordService â€º createRecord â€º Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÑ‚ÑŒ Ñ†ÐµÐ»Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ Ñ‡ÐµÑ€ÐµÐ· gate Ð¿ÐµÑ€ÐµÐ´ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸ÐµÐ¼

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"companyId": "c1", "generationMetadata": {"hash": "h1", "modelId": "m1", "modelVersion": "1.0", "seed": "s1"}, "stages": [{}], "status": "GENERATED_DRAFT"}, undefined

    Number of calls: 0

    [0m [90m 64 |[39m             [36mawait[39m service[33m.[39mcreateRecord(draft[33m,[39m payload[33m,[39m inputParams[33m,[39m { summary[33m:[39m [32m'report'[39m })[33m;[39m
     [90m 65 |[39m
    [31m[1m>[22m[39m[90m 66 |[39m             expect(gate[33m.[39mvalidateGeneratedDraft)[33m.[39mtoHaveBeenCalledWith(draft[33m,[39m undefined)[33m;[39m [90m// gate mock verification might need adjustment if it expects args[39m
     [90m    |[39m                                                 [31m[1m^[22m[39m
     [90m 67 |[39m             expect(prisma[33m.[39mgenerationRecord[33m.[39mcreate)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m 68 |[39m         })[33m;[39m
     [90m 69 |[39m[0m

      at Object.<anonymous> (src/modules/generative-engine/record/generation-record.service.spec.ts:66:49)

  â— GenerationRecordService â€º createRecord â€º Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð´ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ‚Ð¾Ð² (P2002)

    expect(received).rejects.toThrow(expected)

    Expected pattern: /Record already exists/

    Received function did not throw

    [0m [90m 78 |[39m
     [90m 79 |[39m             [36mawait[39m expect(service[33m.[39mcreateRecord(draft[33m,[39m [32m'{"p":1}'[39m[33m,[39m { p[33m:[39m [35m1[39m }[33m,[39m [36mnull[39m))
    [31m[1m>[22m[39m[90m 80 |[39m                 [33m.[39mrejects[33m.[39mtoThrow([35m/Record already exists/[39m)[33m;[39m
     [90m    |[39m                          [31m[1m^[22m[39m
     [90m 81 |[39m         })[33m;[39m
     [90m 82 |[39m     })[33m;[39m
     [90m 83 |[39m[0m

      at Object.toThrow (../../node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/modules/generative-engine/record/generation-record.service.spec.ts:80:26)

  â— GenerationRecordService â€º verifyRecordIntegrity â€º Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð´ÐµÐ»ÐµÐ³Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ gate

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"id": "r1"}

    Number of calls: 0

    [0m [90m 89 |[39m             [36mawait[39m service[33m.[39mverifyRecordIntegrity([32m'r1'[39m)[33m;[39m
     [90m 90 |[39m
    [31m[1m>[22m[39m[90m 91 |[39m             expect(gate[33m.[39mvalidateRecordIntegrity)[33m.[39mtoHaveBeenCalledWith(record)[33m;[39m
     [90m    |[39m                                                  [31m[1m^[22m[39m
     [90m 92 |[39m         })[33m;[39m
     [90m 93 |[39m     })[33m;[39m
     [90m 94 |[39m })[33m;[39m[0m

      at Object.<anonymous> (src/modules/generative-engine/record/generation-record.service.spec.ts:91:50)

Test Suites: 1 failed, 1 total
Tests:       3 failed, 3 total
Snapshots:   0 total
Time:        37.945 s, estimated 91 s
Ran all test suites matching /src\\modules\\generative-engine\\record\\generation-record.service.spec.ts/i.
